<!doctype html><html lang=en-us><head><title>Migrating CATPAW Development to Azure // The Grinnell College Digital Library Application Developer's Blog</title><meta charset=utf-8><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Mark A. McFate"><meta name=description content><link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.bc1abb622a656fb4c816fed09d36c15e272b31b7beae2e7113b2f9418bff0361.css><script type=text/javascript src=https://static.grinnell.edu/dlad-blog/js/pdf-js/build/pdf.js></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Migrating CATPAW Development to Azure"><meta name=twitter:description content="Portions of this post build on concepts introduced in Managing Azure.
CATPAW - Computer-Aided Thinking, Primarily about Writing From the CATPAW home screen&mldr;
In many ways, CATPAW is an online book about writing style&ndash;a guide to the choices we make in writing that connect us to our readers.
Rather than setting out rules to follow, CATPAW will help you make informed choices in context. The site accomplishes that goal in three ways:
It explains the choices writers face. It uses computational tools to help you examine your own writing, letting you see what choices you have already made and what you might want to do differently."><meta property="og:title" content="Migrating CATPAW Development to Azure"><meta property="og:description" content="Portions of this post build on concepts introduced in Managing Azure.
CATPAW - Computer-Aided Thinking, Primarily about Writing From the CATPAW home screen&mldr;
In many ways, CATPAW is an online book about writing style&ndash;a guide to the choices we make in writing that connect us to our readers.
Rather than setting out rules to follow, CATPAW will help you make informed choices in context. The site accomplishes that goal in three ways:
It explains the choices writers face. It uses computational tools to help you examine your own writing, letting you see what choices you have already made and what you might want to do differently."><meta property="og:type" content="article"><meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/135-migrating-catpaw-development-to-azure/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-11T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-11T00:00:00+00:00"><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://analytics.summittservices.com/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","16"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></head><body><header class=app-header><a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a><h2>The Grinnell College Digital Library Application Developer's Blog</h2><div class=author-block><p class=site-rev>Compiled: Mar 17, 2023 at 9:10am CDT<br>Content Updated: 2023-Mar-17 08:25 CDT</p><div class=name>by
<strong>Mark A. McFate</strong></div><div class=address>Grinnell College Libraries</div><div class=link><a href=mailto:></a></div><br></div><nav class=sidebar-nav><a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a></nav><p class=site-description>Mark&rsquo;s first Hugo site, a blog, formerly on prem at Static.Grinnell.edu, moved to <em>DigitalOcean</em>, then to <em>Azure</em>, and now hosted on <em>GitHub Pages</em>.</p><div class=app-header-social><a target=_blank href=https://github.com/McFateM><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/gohugoio><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div><p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p></header><main class=app-container><div class=breadcrumbs><a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/135-migrating-catpaw-development-to-azure/>135 migrating catpaw development to azure</a></div><article class=post><header class=post-header><h1 class=post-title>Migrating CATPAW Development to Azure</h1><div class=post-meta><script>console.log("Hugo Debug: ",JSON.parse('"2023-01-12T00:00:00Z"'))</script><script>console.log("Hugo Debug: ",JSON.parse('"2023-01-11T00:00:00Z"'))</script><script>console.log("Hugo Debug: ",JSON.parse('"2023-01-12T18:45:00Z"'))</script><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Jan 11, 2023
&nbsp;&nbsp;&bull;&nbsp;&nbsp;Updated: Jan 12, 2023 18:45
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/migration/>migration</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/catpaw/>CATPAW</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/azure/>Azure</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/python/>Python</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/flask/>Flask</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/vscode/>VSCode</a></div></div></header><div class=post-content><p>Portions of this post build on concepts introduced in <a href=https://static.grinnell.edu/dlad-blog/posts/130-managing-azure/>Managing Azure</a>.</p><h2 id=catpaw---computer-aided-thinking-primarily-about-writing>CATPAW - Computer-Aided Thinking, Primarily about Writing</h2><p>From the CATPAW home screen&mldr;</p><div class=original><p>In many ways, CATPAW is an online book about writing style&ndash;a guide to the choices we make in writing that connect us to our readers.</p><p>Rather than setting out rules to follow, CATPAW will help you make informed choices in context. The site accomplishes that goal in three ways:</p><ul><li>It explains the choices writers face.</li><li>It uses computational tools to help you examine your own writing, letting you see what choices you have already made and what you might want to do differently.</li><li>It places these choices in the context of advice from other prominent guides to writing.</li></ul></div><h3 id=technical-notes>Technical Notes</h3><p>CATPAW is a <a href=https://flask.palletsprojects.com/en/2.2.x/#>Python Flask</a> web application that employs a number of Python packages including <a href=https://www.nltk.org/>nltk: the Natural Language Toolkit</a>.</p><h3 id=project-history>Project History</h3><p>CATPAW was created by <a href=https://www.grinnell.edu/user/simpsone>Professor Erik Simpson</a> with initial programming assistance from <a href=https://www.linkedin.com/in/alinaguha>Alina Guha</a> and myself. Throughout its history, CATPAW development and collaboration has engaged a <code>git</code> workflow with code updates posted to GitHub private repositories.</p><h4 id=initial-development-and-deployment-to-azure>Initial Development and Deployment to Azure</h4><p>The first CATPAW code repository is/was <a href=https://github.com/alinejg/catpaw>https://github.com/alinejg/catpaw</a>. This repo was initially deployed to the web via <em>Azure</em> under a &ldquo;trial&rdquo; account owned by Alina. When the trial subscription ended we took steps to move the deployment from <em>Azure</em> to <em>Reclaim Cloud</em> to avoid accumulating fees on Alina&rsquo;s <em>Azure</em> account.</p><p>The <code>README.md</code> file from the aforementioned original project documents early development and the move to <em>Reclaim Cloud</em>. That original <code>README.md</code> was exported to a file named <code>README-original.pdf</code> that&rsquo;s stored in our current development repo <a href=#catpaw-azure>CATPAW-Azure</a> below. The PDF is available for download in this post&rsquo;s <a href=#attachments>Attachments</a> section for convenience.</p><h2 id=catpaw-deployment-to-reclaim-cloud>CATPAW Deployment to Reclaim Cloud</h2><p>Deployment to <em>Reclaim Cloud</em> provided us with very few options, and all of them incurred fees throughout the development lifecycle. Fortunately, the fees were not too significant and they were covered with budget and credits secured by the <a href=https://www.grinnell.edu/academics/centers-programs/ctla/dlac>DLAC</a>.</p><p>Our deployment to <em>Reclaim Cloud</em> also encountered two technical challenges:</p><ol><li><p>Due to the nature of <em>Flask</em> and its built-in webserver, we had to maintain two different versions of the code, one for the <em>local</em>/<em>development</em> websever, and a second copy for any <em>remote</em>/<em>deployed</em> using a <a href=https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface>wsgi</a> interface. A pair of <code>.sh</code> scripts were created to manually switch between versions. Specific differences between versions are documented in the aforementioned <code>README-original.pdf</code> provided below.</p></li><li><p>Recently, the addition of new <a href=https://www.nltk.org/>nltk</a> elements and a <a href=https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html>pandas.DataFrame</a> object introduced a configuration where the code would run <em>locally</em>, but the modified <em>wsgi</em> version would not successfully deploy to <em>Reclaim Cloud</em>.</p></li></ol><h2 id=catpaw-azure>CATPAW-Azure</h2><p>While addressing technical problem #2, above, we discovered that returning to <em>Azure</em> might provide a more flexible and free, or very low-cost, deployment alternative to <em>Reclaim Cloud</em>, and new <a href=https://code.visualstudio.com/docs/azure/extensions><em>Azure</em> VSCode extensions</a> could be leveraged to simplify the move. Furthermore, these <em>VSCode</em> extensions provide nearly seemless integration with <a href=https://azure.microsoft.com/en-us/products/app-service/>Azure App Service</a>, and most importantly, <strong>there is no need to maintain separate <em>local</em> and <em>wsgi</em> versions of code when deploying to <em>Azure</em></strong>. Yay!</p><p>A search of the web for &ldquo;azure python flask&rdquo; returned a host of promising articles and I choose to create a new <em>CATPAW</em> project repo, <a href=https://github.com/Digital-Grinnell/catpaw-azure>https://github.com/Digital-Grinnell/catpaw-azure</a>, and to develop it using the guidance found in <a href=https://medium.datadriveninvestor.com/deploying-flask-web-app-on-microsoft-azure-89cea17e9114>Deploying Flask web app on Microsoft Azure.</a>, and later in <a href=https://learn.microsoft.com/en-us/azure/app-service/quickstart-python>Quickstart: Deploy a Python (Django or Flask) web app to Azure App Service</a>.</p><p>The original description of <a href=https://github.com/Digital-Grinnell/catpaw-azure>https://github.com/Digital-Grinnell/catpaw-azure</a> was:</p><p>A restart of CATPAW work from 2022, this time destined for dev deployment in Azure App Service.</p><p>The <code>README.md</code> file from the <em>development</em> branch of <a href=https://github.com/Digital-Grinnell/catpaw-azure>https://github.com/Digital-Grinnell/catpaw-azure</a> explains some of the repositories&rsquo; early history and it can be downloaded here as <code>README-catpaw-azure.pdf</code>.</p><style>section.attachments{margin:1.5rem 0;position:relative;label { font-weight: 300; margin: 0; } .attachments-files { display: block; font-size: 1rem; margin: 0; ul { margin-top: 0; } .attachment-size { display: inline-block; color: var(--font-color-muted); } } .new-tab { padding-left: 0.1em; padding-right: 0.1em; }}</style><section class=attachments><label><a name=attachments><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-paperclip"><title>paperclip</title><path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"/></svg>&nbsp; Attachments</a></label><div class=attachments-files><ul><li><a class="tooltipped tooltipped-n" aria-label=Download href=https://static.grinnell.edu/dlad-blog/posts/135-migrating-catpaw-development-to-azure/files/README-catpaw-azure.pdf download>README-catpaw-azure.pdf</a>
<a class="new-tab tooltipped tooltipped-n" aria-label="Open in new tab" href=https://static.grinnell.edu/dlad-blog/posts/135-migrating-catpaw-development-to-azure/files/README-catpaw-azure.pdf target=_blank><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-download"><title>download</title><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></a><div class=attachment-size>(151kb)</div></li><li><a class="tooltipped tooltipped-n" aria-label=Download href=https://static.grinnell.edu/dlad-blog/posts/135-migrating-catpaw-development-to-azure/files/README-original.pdf download>README-original.pdf</a>
<a class="new-tab tooltipped tooltipped-n" aria-label="Open in new tab" href=https://static.grinnell.edu/dlad-blog/posts/135-migrating-catpaw-development-to-azure/files/README-original.pdf target=_blank><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-download"><title>download</title><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></a><div class=attachment-size>(718kb)</div></li></ul></div></section><h2 id=pandas-vs-polars>Pandas vs Polars</h2><p>Also while addressing problem #2 (see above) we found that a successful <em>local</em> build using the <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html>Pandas dataframe</a> class could not be successfully deployed to <em>Reclaim Cloud</em>, nor to <em>Azure</em>. The <em>Azure</em> error messages hinted at the platforms inability to &ldquo;build&rdquo; <em>Pandas</em> due to a missing <code>python.h</code> file. Also, the build time in <em>Azure</em> with <em>Pandas</em> included was 10x the time when building the app without <em>Pandas</em>.</p><p>I tried 8 different deployment configurations in hopes of making <em>Pandas</em> work in <em>Azure</em>, but they all failed with the same error. So, rather than perpetuating failures I elected to look for an alternative to <em>Pandas</em> to determine if that was indeed the source of the error. It was.</p><p>Ultimately I choose to rewrite a small portion of the <code>app.py</code> code to remove <em>Pandas</em> and replace it with &ldquo;equivalent&rdquo; code using the <a href=https://www.pola.rs/>Polars DataFrame Library</a>. <em>Polars</em> not only works, both <em>locally</em> and in <em>Azure</em>, but its associated build-time is one tenth what <em>Pandas</em> required.</p><p>At the time of this writing (2023-01-12T12:44:01-06:00) the <code>development</code> branch of <a href=https://github.com/Digital-Grinnell/catpaw-azure>catpaw-azure</a> is using <em>Polars</em>, while the <code>main</code> branch still employs the broken <em>Pandas</em> logic. I expect a merge of these branches and adoption of <em>Polars</em> soon.</p><hr><p>There may be more to come, but for now&mldr; that&rsquo;s a wrap.</p></div><div class=post-footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//digital-library-applications-developer-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></main></body></html>