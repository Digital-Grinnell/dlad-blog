<!doctype html><html lang=en-us>
<head>
<title>ISLE Workflow Test // The Grinnell College Digital Library Application Developer's Blog</title>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.92.2">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Mark A. McFate">
<meta name=description content>
<link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.a0a90779d7d7dc7111202c97d61bd4963b7236dd704adac1f03ff9f07a45d022.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="ISLE Workflow Test">
<meta name=twitter:description content="ISLE v1.3.0 has been running on my staging server, DGDockerX, for about 6 weeks now and it seems to be performing as-expected with one exception&mldr; when I try to import a batch of objects using IMI, the Islandora Multi-Importer, I get the following error:
The website encountered an unexpected error. Please try again later. An examination of Recent log messages shows&mldr;
GuzzleHttp\Exception\ConnectException: cURL error 6: Could not resolve host: sheets.googleapis.com (see https://curl.haxx.se/libcurl/c/libcurl-errors.html) in GuzzleHttp\Handler\CurlFactory::createRejection() (line 200 of /var/www/html/sites/all/modules/islandora/islandora_multi_importer/vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php). Engaging the Local Workflow Since I&rsquo;m not at all sure what&rsquo;s wrong, I feel like I need to rewind my process a bit and try to reproduce the same configuration, and error, on a local instance of this ISLE stack.">
<meta property="og:title" content="ISLE Workflow Test">
<meta property="og:description" content="ISLE v1.3.0 has been running on my staging server, DGDockerX, for about 6 weeks now and it seems to be performing as-expected with one exception&mldr; when I try to import a batch of objects using IMI, the Islandora Multi-Importer, I get the following error:
The website encountered an unexpected error. Please try again later. An examination of Recent log messages shows&mldr;
GuzzleHttp\Exception\ConnectException: cURL error 6: Could not resolve host: sheets.googleapis.com (see https://curl.haxx.se/libcurl/c/libcurl-errors.html) in GuzzleHttp\Handler\CurlFactory::createRejection() (line 200 of /var/www/html/sites/all/modules/islandora/islandora_multi_importer/vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php). Engaging the Local Workflow Since I&rsquo;m not at all sure what&rsquo;s wrong, I feel like I need to rewind my process a bit and try to reproduce the same configuration, and error, on a local instance of this ISLE stack.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/060-isle-workflow-test/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-01-27T00:00:00+00:00">
<meta property="article:modified_time" content="2020-02-11T09:19:36-06:00">
</head>
<body>
<header class=app-header>
<a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a>
<h2>The Grinnell College Digital Library Application Developer's Blog</h2>
<div class=author-block>
<p class=site-rev>
Compiled: Feb 17, 2022 at 11:08am CST<br>
Content Updated: 2022-Feb-17 00:00 UTC
</p>
<div class=name>by
<strong>Mark A. McFate</strong></div>
<div class=address>Grinnell College Libraries</div>
<div class=link><a href=mailto:></a></div>
<br>
</div>
<nav class=sidebar-nav>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a>
</nav>
<p class=site-description>Mark's first Hugo site, a blog, formerly at Static.Grinnell.edu, moved to DigitalOcean, and now hosted on Azure.</p>
<div class=app-header-social>
<a target=_blank href=https://github.com/McFateM><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>
<a target=_blank href=https://twitter.com/gohugoio><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a>
</div>
<p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p>
</header>
<main class=app-container>
<div class=breadcrumbs>
<a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/060-isle-workflow-test/>060 isle workflow test</a>
</div>
<article class=post>
<header class=post-header>
<h1 class=post-title>ISLE Workflow Test</h1>
<div class=post-meta>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
9 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Jan 27, 2020
&nbsp;&nbsp;&bull;&nbsp;&nbsp;Updated: Feb 11, 2020 - 09:19
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=https://static.grinnell.edu/dlad-blog/tags/isle/>ISLE</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/dg.localdomain/>dg.localdomain</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/local/>local</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/development/>development</a></div></div>
</header>
<div class=post-content>
<p>ISLE v1.3.0 has been running on my staging server, <code>DGDockerX</code>, for about 6 weeks now and it seems to be performing as-expected with one exception&mldr; when I try to import a batch of objects using IMI, the <em>Islandora Multi-Importer</em>, I get the following error:</p>
<pre tabindex=0><code>The website encountered an unexpected error. Please try again later.
</code></pre><p>An examination of <a href=https://isle-stage.grinnell.edu/admin/reports/dblog>Recent log messages</a> shows&mldr;</p>
<pre tabindex=0><code>GuzzleHttp\Exception\ConnectException: cURL error 6: Could not resolve host: sheets.googleapis.com (see https://curl.haxx.se/libcurl/c/libcurl-errors.html) in GuzzleHttp\Handler\CurlFactory::createRejection() (line 200 of /var/www/html/sites/all/modules/islandora/islandora_multi_importer/vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php).
</code></pre><h2 id=engaging-the-local-workflow>Engaging the Local Workflow</h2>
<p>Since I&rsquo;m not at all sure what&rsquo;s wrong, I feel like I need to rewind my process a bit and try to reproduce the same configuration, and error, on a <strong>local</strong> instance of this ISLE stack. This post will chronicle the steps I take to do so.</p>
<h2 id=directories>Directories</h2>
<p>I&rsquo;ll begin by opening a terminal on my workstation/host, <code>MA8660</code> as user <code>mcfatem</code>. Then I very carefully (note the use of the <code>--recursive</code> flags!) clone the aforementioned projects to the host&rsquo;s <code>~/GitHub</code> directory like so:</p>
<table>
<thead>
<tr>
<th>Host Commands</th>
</tr>
</thead>
<tbody>
<tr>
<td>cd ~/GitHub<br>git clone &ndash;recursive <a href=https://github.com/Digital-Grinnell/dg-isle.git>https://github.com/Digital-Grinnell/dg-isle.git</a><br>git clone &ndash;recursive <a href=https://github.com/Digital-Grinnell/dg-islandora.git>https://github.com/Digital-Grinnell/dg-islandora.git</a><br>cd dg-isle</td>
</tr>
</tbody>
</table>
<h2 id=launch-the-dglocaldomain-stack>Launch the <strong>dg.localdomain</strong> Stack</h2>
<p>I&rsquo;m modifying the <code>.env</code> file in the <code>dg-isle</code> directory so that &ldquo;local&rdquo; is my target environment. Having done that, I will launch the local stack using:</p>
<table>
<thead>
<tr>
<th>Host Commands</th>
</tr>
</thead>
<tbody>
<tr>
<td>cd ~/GitHub/dg-isle <br> git checkout master <br> docker-compose up -d <br> docker logs -f isle-apache-dg</td>
</tr>
</tbody>
</table>
<p>The startup will take a couple of minutes, and it does not &ldquo;signal&rdquo; when it&rsquo;s done, so that&rsquo;s the reason for the last command above. The <code>-f</code> option will keep the output spooling to your terminal so that you don&rsquo;t have to keep repeating the command over and over again. You will know the startup is complete when you see something like the following at the bottom of the log output:</p>
<pre tabindex=0><code>...
Done setting proper permissions on files and directories
XDEBUG OFF
AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 172.20.0.7. Set the 'ServerName' directive globally to suppress this message
AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 172.20.0.7. Set the 'ServerName' directive globally to suppress this message
[Mon Feb 03 22:16:46.898249 2020] [mpm_prefork:notice] [pid 12698] AH00163: Apache/2.4.41 (Ubuntu) configured -- resuming normal operations
[Mon Feb 03 22:16:46.898652 2020] [core:notice] [pid 12698] AH00094: Command line: '/usr/sbin/apache2 -D FOREGROUND
</code></pre><p>Press <code>ctrl-c</code> to interrupt the <code>docker logs...</code> command and get your terminal back.</p>
<p>A visit to <a href=https://dg.localdomain>https://dg.localdomain</a> yields a very incomplete Bartik-themed site, and it looks like we are far from creating a local <em>Digital.Grinnell</em>. So, the next logical step is to backup the database from <a href=https://isle-stage.grinnell.edu>https://isle-stage.grinnell.edu</a>, and import it here.</p>
<h2 id=backup-the-site-database>Backup the Site Database</h2>
<p>Let&rsquo;s begin by visiting the <a href=https://isle-stage.grinnell.edu>site&rsquo;s home page</a> and using the <code>Quick Backup</code> block at the bottom of the right-hand sidebar. Normally I would select a <code>Backup Destination: Manual Backups Directory</code> option to save the database backup on the server, but in this case it will be advantageous to have the backup in-hand, locally. So, I choose <code>Backup Destination: Download</code> instead, and the result is in my local <code>~/Downloads</code> directory, specifically:</p>
<p><code>/Users/markmcfate/Downloads/DigitalGrinnell-2020-02-03T14-33-13.mysql.gz</code></p>
<h2 id=import-the-database-backup-locally>Import the Database Backup Locally</h2>
<p>This is as simple as:</p>
<ul>
<li>Opening <code>https://dg.localdomain</code> in my browser,</li>
<li>Logging in as a system admin,</li>
<li>Open <a href="https://dg.localdomain/node#overlay=admin/module">https://dg.localdomain/node#overlay=admin/module</a> and enable the <code>Backup and Migrate</code> module,</li>
<li>Save the configuration change,</li>
<li>Open <a href="https://dg.localdomain/node#overlay=admin/config/system/backup_migrate/restore">https://dg.localdomain/node#overlay=admin/config/system/backup_migrate/restore</a>,</li>
<li><code>Browse</code> to the aforementioned database backup <code>.gz</code> file, and</li>
<li>Click <code>Restore now</code></li>
</ul>
<h2 id=white-screen-of-death>White Screen of Death</h2>
<p>Not good, when I visit <a href=https://dg.localdomain>https://dg.localdomain</a> now I get a dreaded <strong>WSOD</strong>. So I peek at the <em>Apache</em> container logs using <code>docker logs isle-apache-ld</code> and find this:</p>
<pre tabindex=0><code>[Mon Feb 03 20:41:55.684244 2020] [php7:error] [pid 13002] [client 172.20.0.4:43034] PHP Fatal error:  require_once(): Failed opening required '/var/www/html/sites/all/modules/islandora/islandora_multi_importer/vendor/autoload.php' (include_path='.:/usr/share/php') in /var/www/html/sites/all/modules/islandora/islandora_multi_importer/islandora_multi_importer.module on line 19, referer: https://dg.localdomain/admin/config/system/backup_migrate/restore?render=overlay
172.20.0.4 - - [03/Feb/2020:20:41:52 +0000] &quot;GET /admin/config/system/backup_migrate/restore?render=overlay HTTP/1.1&quot; 500 333 &quot;https://dg.localdomain/admin/config/system/backup_migrate/restore?render=overlay&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:72.0) Gecko/20100101 Firefox/72.0
</code></pre><p>Bottom line, there are critical issues with IMI, the <em>Islandora Multi-Importer</em>, just as there were in staging. Hmm, what to do now?</p>
<h2 id=fixing-imi>Fixing IMI</h2>
<p>I open a terminal into the <em>Apache</em> container and attempt to repair/re-install <em>IMI</em> like so:</p>
<table>
<thead>
<tr>
<th>Apache Container Commands</th>
</tr>
</thead>
<tbody>
<tr>
<td>cd /var/www/html/sites/all/modules/islandora/islandora_multi-importer <br> git remote -v <br> git status <br> composer install</td>
</tr>
</tbody>
</table>
<p>The commands and output from all of this are reflected <a href=https://gist.github.com/Digital-Grinnell/554ec36828e0e4f9b8f7c8e499a8221>in this gist</a>.</p>
<h2 id=is-it-fixed-yes-sort-of>Is It Fixed? Yes, Sort Of</h2>
<p>A browser visit to <a href=https://dg.localdomain>https://dg.localdomain</a> demonstrates that the site is back! However, the site is currently showing <code>Operating in maintenance mode. Go online</code>, and there are multiple warnings indicating:</p>
<pre tabindex=0><code>User warning: The following module is missing from the file system: islandora_binary_object.
</code></pre><p>When I click the <code>Go online</code> link and complete the operation, the site does indeed respond by showing me an almost-proper home page, complete with numerous collection objects. I says it&rsquo;s &ldquo;almost-proper&rdquo; because in addition to the top-level collections, the site is also showing a host of individual objects. This should NOT be the case, but I can think of a handful of remedies, including:</p>
<ul>
<li>Using the <code>Development</code> menu <code>Clear cache</code> link to do just what the name says.</li>
</ul>
<p>Ok, so that actually worked; no need to go farther.</p>
<h2 id=will-the-same-fixes-work-on-staging>Will the Same Fixes Work on Staging?</h2>
<p>Only one way to find out. First, I&rsquo;m going to snapshot the <code>DGDockerX</code> staging server. Done. Then&mldr;</p>
<table>
<thead>
<tr>
<th>Apache Container Commands</th>
</tr>
</thead>
<tbody>
<tr>
<td>cd /var/www/html/sites/all/modules/islandora/islandora_multi-importer <br> composer install</td>
</tr>
</tbody>
</table>
<p>And the output this time says:</p>
<pre tabindex=0><code>root@60ccb7d0ae42:/var/www/html/sites/all/modules/islandora/islandora_multi_importer# composer install
Loading composer repositories with package information
Installing dependencies (including require-dev) from lock file
Nothing to install or update
Package phpoffice/phpexcel is abandoned, you should avoid using it. Use phpoffice/phpspreadsheet instead.
Package silex/silex is abandoned, you should avoid using it. Use symfony/flex instead.
Generating autoload file
</code></pre><p>So, to fix this I tried, and got back this:</p>
<pre tabindex=0><code>root@60ccb7d0ae42:/var/www/html/sites/all/modules/islandora/islandora_multi_importer# composer install
Loading composer repositories with package information
Installing dependencies (including require-dev) from lock file
Nothing to install or update
Package phpoffice/phpexcel is abandoned, you should avoid using it. Use phpoffice/phpspreadsheet instead.
Package silex/silex is abandoned, you should avoid using it. Use symfony/flex instead.
Generating autoload files
root@60ccb7d0ae42:/var/www/html/sites/all/modules/islandora/islandora_multi_importer#
root@60ccb7d0ae42:/var/www/html/sites/all/modules/islandora/islandora_multi_importer#
root@60ccb7d0ae42:/var/www/html/sites/all/modules/islandora/islandora_multi_importer#
root@60ccb7d0ae42:/var/www/html/sites/all/modules/islandora/islandora_multi_importer# composer remove phpoffice/phpexcel silex/silex
Loading composer repositories with package information
The &quot;https://repo.packagist.org/packages.json&quot; file could not be downloaded: php_network_getaddresses: getaddrinfo failed: Temporary failure in name resolution
failed to open stream: php_network_getaddresses: getaddrinfo failed: Temporary failure in name resolution
https://repo.packagist.org could not be fully loaded, package information was loaded from the local cache and may be out of date
Updating dependencies (including require-dev)

  [Composer\Downloader\TransportException]
  The &quot;http://repo.packagist.org/p/cache/taggable-cache%247eb77da84984bd6522fb9e3e91f4f82107555cba862c9f161cd3ff697dcc6f7c.json&quot; file could not be downloaded: php_network_getaddresses: getaddrinfo failed: Temporary failure in name resolution
  failed to open stream: php_network_getaddresses: getaddrinfo failed: Temporary failure in name resolution

remove [--dev] [--no-progress] [--no-update] [--no-scripts] [--update-no-dev] [--update-with-dependencies] [--no-update-with-dependencies] [--ignore-platform-reqs] [-o|--optimize-autoloader] [-a|--classmap-authoritative] [--apcu-autoloader] [--] &lt;packages&gt; (&lt;packages&gt;)...
</code></pre><p>Next stop&mldr; a staging copy of <em>Digital.Grinnell</em> on <em>DigitalOcean</em>? Yup, headed there now. 😦 But the address will be <a href=https://staging.summittservices.com>https://staging.summittservices.com</a>, when it&rsquo;s ready.</p>
<p>That&rsquo;s a wrap. Until next time&mldr;</p>
</div>
<div class=post-footer>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//digital-library-applications-developer-blog.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</article>
</main>
</body>
</html>