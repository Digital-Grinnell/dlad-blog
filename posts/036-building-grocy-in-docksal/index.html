<!doctype html><html lang=en><head><title>Building Grocy in Docksal // The Grinnell College Digital Library Application Developer's Blog</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.140.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Mark A. McFate"><meta name=description content><link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.5efe2f062080343a28f3b21576ff0c6dbf2b0a5d89ed855f45479992bd62d0e6.css><script type=text/javascript src=https://static.grinnell.edu/dlad-blog/js/pdf-js/build/pdf.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=288703662"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","288703662")}</script><meta name=twitter:card content="summary"><meta name=twitter:title content="Building Grocy in Docksal"><meta name=twitter:description content="Grocy looks lika a great little PHP stack application for me. It’s aim is to help folks organize and inventory their “stuff”, with a slant toward food and groceries. I need this!
Since I’m also a big fan of Docker and Docksal, naturally I wanted to spin Grocy up in one of these environments. Thankfully, the heavy lifting of getting this “Dockerized” has already been done, and that fine work is shared in GitHub at grocy/grocy-docker. So my quest last evening started with a fork of this GitHub project to SummittDweller/grocy-docker, where I’ve created a new docksal branch."><meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/036-building-grocy-in-docksal/"><meta property="og:site_name" content="The Grinnell College Digital Library Application Developer's Blog"><meta property="og:title" content="Building Grocy in Docksal"><meta property="og:description" content="Grocy looks lika a great little PHP stack application for me. It’s aim is to help folks organize and inventory their “stuff”, with a slant toward food and groceries. I need this!
Since I’m also a big fan of Docker and Docksal, naturally I wanted to spin Grocy up in one of these environments. Thankfully, the heavy lifting of getting this “Dockerized” has already been done, and that fine work is shared in GitHub at grocy/grocy-docker. So my quest last evening started with a fork of this GitHub project to SummittDweller/grocy-docker, where I’ve created a new docksal branch."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-08T00:00:00+00:00"><meta property="article:modified_time" content="2019-08-11T08:34:34-05:00"><meta property="article:tag" content="Grocy"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Docksal"><meta property="article:tag" content="Fin"><meta property="article:tag" content="Docker-Compose"><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://analytics.summittservices.com/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","16"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></head><body><header class=app-header><a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a><h2>The Grinnell College Digital Library Application Developer's Blog</h2><div class=author-block><p class=site-rev>Compiled: Dec 20, 2024 at 8:45am CST<br>Content Updated: 2024-Dec-19 17:08 CST</p><div class=name>by
<strong>Mark A. McFate</strong></div><div class=address>Grinnell College Libraries</div><div class=link><a href=mailto:></a></div><br></div><nav class=sidebar-nav><a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a></nav><p class=site-description>Mark&rsquo;s first Hugo site, a blog, formerly on prem at Static.Grinnell.edu, moved to <em>DigitalOcean</em>, then to <em>Azure</em>, and now hosted on <em>GitHub Pages</em>.</p><div class=app-header-social><a target=_blank href=https://github.com/McFateM><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>
<a target=_blank href=https://twitter.com/gohugoio><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div><p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p></header><main class=app-container><div class=breadcrumbs><a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/036-building-grocy-in-docksal/>036 building grocy in docksal</a></div><article class=post><header class=post-header><h1 class=post-title>Building Grocy in Docksal</h1><div class=post-meta><script>console.log("Hugo Debug: ",JSON.parse('"2019-08-09T00:00:00Z"'))</script><script>console.log("Hugo Debug: ",JSON.parse('"2019-08-11T08:34:34-05:00"'))</script><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
6 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Aug 8, 2019
&nbsp;&nbsp;&bull;&nbsp;&nbsp;Updated: Aug 11, 2019 08:34
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=https://static.grinnell.edu/dlad-blog/tags/grocy/>Grocy</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/docker/>Docker</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/docksal/>Docksal</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/fin/>Fin</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/docker-compose/>Docker-Compose</a></div></div></header><div class=post-content><p><a href=https://github.com/grocy/grocy>Grocy</a> looks lika a great little PHP stack application for me. It&rsquo;s aim is to help folks organize and inventory their &ldquo;stuff&rdquo;, with a slant toward food and groceries. I need this!</p><p>Since I&rsquo;m also a big fan of <a href=https://docker.io>Docker</a> and <a href=https://docksal.io>Docksal</a>, naturally I wanted to spin Grocy up in one of these environments. Thankfully, the heavy lifting of getting this &ldquo;Dockerized&rdquo; has already been done, and that fine work is shared in GitHub at <a href=https://github.com/grocy/grocy-docker>grocy/grocy-docker</a>. So my quest last evening started with a fork of this GitHub project to <a href=https://github.com/SummittDweller/grocy-docker>SummittDweller/grocy-docker</a>, where I&rsquo;ve created a new <code>docksal</code> branch.</p><table><thead><tr><th>Disclaimer</th></tr></thead><tbody><tr><td>Note that <code>grocy</code> is not really work-related for me, but this process of &ldquo;Dockerizing&rdquo; and &ldquo;Docksalizing&rdquo; it is. So that&rsquo;s why this post is here and not in my personal blog.</td></tr></tbody></table><h2 id=dockerizing-the-local-stack>Dockerizing the Local Stack</h2><p>I first forked the project using GitHub&rsquo;s interface, then switched to my personal MacBook and the terminal there, like this:</p><table><thead><tr><th>Workstation Commands</th></tr></thead><tbody><tr><td>cd ~/Projects<br>git clone <a href=https://github.com/SummittDweller/grocy-docker>https://github.com/SummittDweller/grocy-docker</a> # clone the fork to local</br>cd grocy-docker<br>git checkout -b docksal # create a new <code>docksal</code> local branch<br>atom . # open the new local project directory in my <a href=https://atom.io>Atom</a> editor<br>docker-compose pull # pull the images as instructed<br>docker-compose up -d # bring up the stack before any modifications</td></tr></tbody></table><p>I should mention that before all of this I edited my MacBook&rsquo;s <code>/etc/hosts</code> file to make sure I had only one active entry there for <code>127.0.0.1 localhost</code>. &#9745;&#xfe0f; Confirmed.</p><p>So, I opened my browser to <code>https://localhost</code> as directed in the <a href=https://github.com/grocy/grocy-docker>grocy-docker documentation</a>. &#x1f4af; Nice!</p><p>The original <code>docker-compose.yml</code> file for this project creates a Docker-managed volume called <code>database</code> and maps that volume to the <code>grocy</code> container&rsquo;s <code>/www</code> directory, one level above the <code>/www/public</code> webroot. The pertinent lines from <code>docker-compose.yml</code> look like this:</p><pre tabindex=0><code>grocy:
  ...
  volumes:
    - database:/www
  ...
volumes:
  database:
</code></pre><p>That effectively &ldquo;persists&rdquo; any changes I make, until I remove them, of course. To test persistence, with the stack still running at https://localhost I entered the default <code>admin</code> user and <code>admin</code> password, navigated to the <code>Master</code> data options and proceeded to add a couple <code>locations</code> to my data.</p><p>Next, with the stack still running I made a new host copy of it all, brought the stack down, changed the configuration, then brought it back up again with the new configuration, like so:</p><table><thead><tr><th>Workstation Commands</th></tr></thead><tbody><tr><td>cd ~/Projects/grocy-docker<br>mkdir docroot # makes a new folder on the host<br>docker cp grocy:/www/. ./docroot/ # copy contents of <code>www</code> in the <code>grocy</code> container to the host&rsquo;s new directory<br>docker-compose down # bring the stack down</td></tr></tbody></table><p>While this approach is OK, I wanted something a little more flexible with an accessible, persistent copy of the code and data on my MacBook host, so I used Atom to edit the <code>docksal</code> copy of <code>docker-compose.yml</code> to look like this:</p><pre tabindex=0><code>grocy:
  ...
  volumes:
    # - database:/www
    - ./docroot:/www
  ...
# volumes:
#   database:
</code></pre><p>Then&mldr;</p><table><thead><tr><th>Workstation Commands</th></tr></thead><tbody><tr><td>cd ~/Projects/grocy-docker<br>docker-compose up -d # bring the stack back up again with the new directory mapping</td></tr></tbody></table><p>Ok, another visit to https://localhost confirms that the stack is working, and when I navigated back into the <code>Master</code> data my <code>locations</code> are still there. &#9745;&#xfe0f; Woot!</p><h2 id=docksalizing-the-local-stack>Docksalizing the Local Stack</h2><p>Ok, not sure I did this &ldquo;correctly&rdquo;, but this process works.</p><table><thead><tr><th>Workstation Commands</th></tr></thead><tbody><tr><td>cd ~/Projects/grocy-docker<br>git checkout -b docksal # switch to the <code>docksal</code> local branch<br>atom . # open the new local project directory in my <a href=https://atom.io>Atom</a> editor<br>fin config generate # accept the default and make this a <code>Docksal</code> stack</td></tr></tbody></table><p>The last command in the above sequence created a new <code>.docksal</code> directory in my project. Yay! It also created a new <code>index.php</code> file in the project&rsquo;s <code>./docroot</code> directory. That&rsquo;s not quite right (and I&rsquo;m not sure how to make <code>fin config generate</code> behave better), but easy to &ldquo;fix&rdquo;.</p><p>I opened <code>./.docksal/docksal.env</code> in Atom and changed it to read:</p><pre tabindex=0><code>DOCKSAL_STACK=default
# DOCROOT=docroot
DOCROOT=docroot/public
</code></pre><p>This simple change effectively moves the default <code>DOCROOT</code> target from <code>./docroot/index.php</code> to the correct <code>grocy</code> target of <code>./docroot/public/index.php</code>.</p><p>To test this change&mldr;</p><table><thead><tr><th>Workstation Commands</th></tr></thead><tbody><tr><td>cd ~/Projects/grocy-docker<br>git checkout -b docksal<br>docker-compose down # bring the stack down<br>docker stop $(docker ps -q) # stop the containers<br>docker rm -v $(docker ps -qa) # remove the stopped containers<br>fin up # bring up the new &ldquo;Docksalized&rdquo; stack</td></tr></tbody></table><p>Now a visit to <a href=http://grocy-docker.docksal>http://grocy-docker.docksal</a> as directed&mldr; and the stack is still working! When I navigated back into the <code>Master</code> data my <code>locations</code> are still there too. &#9745;&#xfe0f; Woot!</p><p>To bring the stack down&mldr;</p><table><thead><tr><th>Workstation Commands</th></tr></thead><tbody><tr><td>cd ~/Projects/grocy-docker<br>git checkout -b docksal<br>fin stop # bring the &ldquo;Docksalized&rdquo; stack down</td></tr></tbody></table><p>Rinse and repeat as necessary.</p><h2 id=weekend-improvements-the-best-kind>Weekend Improvements (the Best Kind!)</h2><p>A few days ago, when this post was originally written, I also posted a &ldquo;feature request&rdquo; into the <a href=https://github.com/grocy/grocy/issues>Grocy issues queue</a>; specifically, it is <a href=https://github.com/grocy/grocy/issues/341>issue 341</a>, which is now closed.</p><p>Within a few hours there were comments posted to this issue; apparently other folks thought this would be a nice addition too. :simple_smile: Not long after that, Grocy&rsquo;s author, <a href=https://berrnd.de/>Bernd Bestel</a> posted <a href=https://github.com/grocy/grocy/issues/341#issuecomment-520152023>this comment</a>:</p><div class=original><p>Sure, any contributions are very welcome. :)</p><p>&mldr;but I&rsquo;m already fiddling together a first draft about this &mldr; will show you in a couple of minutes &mldr; feel free to improve it then&mldr; :)</p></div><p>Wow&mldr; I definitely owe Bernd a beverage of his choosing next time I&rsquo;m in Germany! But I digress&mldr;</p><p>Since I&rsquo;m developing on a Mac, and not Windows, I can&rsquo;t easily run the Grocy code &ldquo;directly&rdquo; out-of-the-box; I need Docker for that. Understandably, the <code>grocy-docker</code> project builds, or pulls, the latest tagged version of <code>grocy/grocy</code>, not the latest code, which resides in the <code>master</code> branch of the repo. So I set to work trying to figure out how to build a Docker, and then Docksal, environment from Bernd&rsquo;s <code>master</code>.</p><p>I made this key substitution in the project&rsquo;s <code>Dockerfile-grocy</code>, along with a few associated and necessary changes:</p><pre tabindex=0><code>#        wget -t 3 -T 30 -nv -O &#34;grocy.zip&#34; &#34;https://github.com/grocy/grocy/archive/v${GROCY_VERSION}.zip&#34; &amp;&amp; \
        wget -t 3 -T 30 -nv -O &#34;grocy.zip&#34; &#34;https://github.com/grocy/grocy/zipball/master&#34; &amp;&amp; \
</code></pre><p>&mldr;and it works using this local command-line process to implement it all.</p><table><thead><tr><th>Workstation Commands</th></tr></thead><tbody><tr><td>cd ~/Projects/grocy-docker<br>git checkout -b docksal<br>docker stop $(docker ps -q); docker rm -v $(docker ps -qa); docker image rm &ndash;force $(docker image ls -q); docker system prune &ndash;force<br>rm -fr docroot/* docroot/.yarnrc<br>docker-compose build; docker-compose up -d<br>docker cp grocy:/www/. docroot/<br>docker-compose down<br>touch docroot/data/demo.txt<br>fin up</td></tr></tbody></table><p>The first three lines ensure I&rsquo;m working in the right location, then bring ALL Docker stacks down and clean-up. Line 4 removes any remnants of my previous <code>./docroot</code> capture, without removing <code>./docroot</code> itself. The 5th line rebuilds <code>grocy</code> in Docker, not Docksal, and starts up the stack. Line 6 makes a copy of the running <code>grocy</code> container for safe-keeping. Line 7 brings the Docker stack down. Line 8 creates an empty <code>./docroot/data/demo.txt</code> file in order to populate my project with a robust set of default locations and items (see <a href=https://github.com/grocy/grocy#demo-mode>this documentation</a> for details). Line 9 brings the new stack back up in Docksal.</p><h3 id=woot-it-works>Woot! It works.</h3><p>I&rsquo;m pushing the latest changes to the <code>docksal</code> branch of <a href=https://github.com/SummittDweller/grocy-docker.git>https://github.com/SummittDweller/grocy-docker.git</a> at this very moment.</p><p>And that&rsquo;s a wrap. Until next time&mldr;</p></div><div class=post-footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//digital-library-applications-developer-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></main></body></html>