<!doctype html><html lang=en-us>
<head>
<title>Problems with dc:identifier Elements // The Grinnell College Digital Library Application Developer's Blog</title>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.92.2">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Mark A. McFate">
<meta name=description content>
<link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.a0a90779d7d7dc7111202c97d61bd4963b7236dd704adac1f03ff9f07a45d022.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Problems with dc:identifier Elements">
<meta name=twitter:description content="The addition of scholar profiles from LASIR, specifically the module&rsquo;s introduction of /mods/identifier[@type='u1'] and /mods/identifier[@type='u2'] fields, has caused a few problems in Digital.Grinnell. Perhaps the most sinister of these&mldr; these fields are transformed into DC or Dublin Core elements that wreak havoc with our OAI export and subsequent import into Primo VE.
OAI Exports While on the subject of OAI, it&rsquo;s worth noting here that we can query to see the OAI that Digital.Grinnell exported by visiting a URL like: https://digital.">
<meta property="og:title" content="Problems with dc:identifier Elements">
<meta property="og:description" content="The addition of scholar profiles from LASIR, specifically the module&rsquo;s introduction of /mods/identifier[@type='u1'] and /mods/identifier[@type='u2'] fields, has caused a few problems in Digital.Grinnell. Perhaps the most sinister of these&mldr; these fields are transformed into DC or Dublin Core elements that wreak havoc with our OAI export and subsequent import into Primo VE.
OAI Exports While on the subject of OAI, it&rsquo;s worth noting here that we can query to see the OAI that Digital.Grinnell exported by visiting a URL like: https://digital.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/120-problems-with-dcidentifer-elements/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-02-18T00:00:00+00:00">
<meta property="article:modified_time" content="2022-02-18T00:00:00+00:00">
</head>
<body>
<header class=app-header>
<a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a>
<h2>The Grinnell College Digital Library Application Developer's Blog</h2>
<div class=author-block>
<p class=site-rev>
Compiled: Feb 18, 2022 at 1:24pm CST<br>
Content Updated: 2022-Feb-18 00:00 UTC
</p>
<div class=name>by
<strong>Mark A. McFate</strong></div>
<div class=address>Grinnell College Libraries</div>
<div class=link><a href=mailto:></a></div>
<br>
</div>
<nav class=sidebar-nav>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a>
</nav>
<p class=site-description>Mark's first Hugo site, a blog, formerly at Static.Grinnell.edu, moved to DigitalOcean, and now hosted on Azure.</p>
<div class=app-header-social>
<a target=_blank href=https://github.com/McFateM><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>
<a target=_blank href=https://twitter.com/gohugoio><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a>
</div>
<p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p>
</header>
<main class=app-container>
<div class=breadcrumbs>
<a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/120-problems-with-dcidentifer-elements/>120 problems with dcidentifer elements</a>
</div>
<article class=post>
<header class=post-header>
<h1 class=post-title>Problems with dc:identifier Elements</h1>
<div class=post-meta>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Feb 18, 2022
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=https://static.grinnell.edu/dlad-blog/tags/iduf/>iduF</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/oai/>OAI</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/dc/>dc</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/identifier/>identifier</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/purgeelements/>PurgeElements</a></div></div>
</header>
<div class=post-content>
<p>The addition of scholar profiles from <a href=https://github.com/Islandora-Collaboration-Group/LASIR>LASIR</a>, specifically the module&rsquo;s introduction of <code>/mods/identifier[@type='u1']</code> and <code>/mods/identifier[@type='u2']</code> fields, has caused a few problems in <em>Digital.Grinnell</em>. Perhaps the most sinister of these&mldr; these fields are transformed into <a href=https://www.dublincore.org/>DC or Dublin Core</a> elements that wreak havoc with our <a href=https://www.openarchives.org/pmh/>OAI</a> export and subsequent import into <a href=https://exlibrisgroup.com/products/primo-discovery-service/>Primo VE</a>.</p>
<h2 id=oai-exports>OAI Exports</h2>
<p>While on the subject of OAI, it&rsquo;s worth noting here that we can query to see the OAI that <em>Digital.Grinnell</em> exported by visiting a URL like: <code>https://digital.grinnell.edu/oai2?verb=ListRecords&metadataPrefix=oai_dc&from=2022-02-15</code>.</p>
<p>Note the <code>from=</code> parameter at the end of the address. Specifying a date here will show us what was exported on the specified date (and since that date?).</p>
<h2 id=a-possible-solution>A Possible Solution?</h2>
<p>I&rsquo;ve confirmed that if all <code>&lt;dc:identifier></code> elements containing <code>u1:*</code> or <code>u2:*</code> values are removed from an object&rsquo;s DC datastream, the object&rsquo;s behavior in <em>Digital.Grinnell</em> is not impacted, and the objects' import to <em>Primo</em> appear to be successful.</p>
<p>Identifying XML elements based on their &ldquo;value&rdquo; can be tricky, but I found that an xpath query like <code>*[contains(.,‚Äôu1:‚Äô) or contains(.,'u2:')]</code> works nicely.</p>
<h2 id=fixing-the-mods-to-dc-transform>Fixing the MODS-to-DC Transform?</h2>
<p>Unfortunately, this is NOT an attractive option because our XSLT is so complex. To be honest, I think ALL XSLT is too complex! <em>I hate XSLT with a passion.</em> The transform that <em>Digital.Grinnell</em> uses can be found in two places on <em>DGDocker1</em>:</p>
<ul>
<li>/var/www/html/sites/all/modules/islandora/dg7/xslt/mods_to_dc_grinnell.xsl, and</li>
<li>/var/www/html/sites/all/modules/islandora/islandora_xml_forms/builder/transforms/mods_to_dc_grinnell.xsl</li>
</ul>
<p>Yes, these two files are IDENTICAL, but a necessary evil due the way that the <code>islandora_xml_forms</code> module is built. I hate that module almost as much as I hate XSLT, maybe more. üò¶</p>
<p>The XSLT that we apply for MODS-to-DC transform reads like this:</p>
<pre tabindex=0><code>  &lt;xsl:template match=&quot;mods:identifier&quot;&gt;  
    &lt;dc:identifier&gt;  
      &lt;xsl:variable name=&quot;type&quot; select=&quot;translate(@type,'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz')&quot;/&gt;  
      &lt;xsl:choose&gt;  
        &lt;!-- 2.0: added identifier type attribute to output, if it is present--&gt;  
        &lt;xsl:when test=&quot;contains(.,':')&quot;&gt;  
          &lt;xsl:value-of select=&quot;.&quot;/&gt;  
        &lt;/xsl:when&gt;  
        &lt;xsl:when test=&quot;@type&quot;&gt;  
          &lt;xsl:value-of select=&quot;$type&quot;/&gt;:¬†&lt;xsl:value-of select=&quot;.&quot;/&gt;  
        &lt;/xsl:when&gt;  
        &lt;xsl:when test=&quot;contains ('isbn issn uri doi lccn', $type)&quot;&gt;  
          &lt;xsl:value-of select=&quot;$type&quot;/&gt;:¬†&lt;xsl:value-of select=&quot;.&quot;/&gt;  
        &lt;/xsl:when&gt;  
        &lt;xsl:otherwise&gt;  
          &lt;xsl:value-of select=&quot;.&quot;/&gt;  
        &lt;/xsl:otherwise&gt;  
      &lt;/xsl:choose&gt;  
    &lt;/dc:identifier&gt;  
  &lt;/xsl:template&gt;  
</code></pre><h2 id=a-viable-solution>A Viable Solution</h2>
<p>What I&rsquo;m going to discuss here isn&rsquo;t an ideal fix because every time we ingest a new object with <code>u1:</code> and/or <code>u2:</code> MODS identifiers, our transform will put them in the object&rsquo;s corresponding DC record. Like I said, not ideal. But there is a relatively easy way to remove what the transforms deposit.</p>
<p>For this purpose I&rsquo;ve resurrected an old, broken <code>drush iduF</code> command. So a command of the form <code>drush -u 1 iduF grinnell:31898-31902 PurgeElements --dsid=DC --xpath="*[contains(.,'u1:') or contains(.,'u2:')]" --verbose</code> can be used to strip the DC object(s) of its/their offending element(s). The command is <code>PurgeElements</code> and the <code>--xpath</code> clause shown above is CRITICAL. As with all <code>drush iduF</code> commands, the <code>--verbose</code> parameter is optional, and <code>--dyrRun</code> is also available for testing.</p>
<p>That command is worth highlighting one more time.</p>
<pre tabindex=0><code>drush -u 1 iduF grinnell:31898-31902 PurgeElements --dsid=DC --xpath=&quot;*[contains(.,'u1:') or contains(.,'u2:')]&quot; --verbose
</code></pre><h2 id=an-xml-namespace-issue>An XML Namespace Issue?</h2>
<p>It&rsquo;s not been confirmed just yet, but there is speculation that the real root of the problem here stems from the apparent existence of <code>srw_dc</code> namespace references that appear in DC records only when identifier <code>u1:</code> or <code>u2:</code> elements exist. You may get some sense of what these references look like on OAI exports from the screen capture shared below.</p>
<link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/hugo-easy-gallery.css>
<div class=box>
<figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject>
<div class=img>
<img itemprop=thumbnail src=https://static.grinnell.edu/dlad-blog/images/post-120/oai_dc-problem.png>
</div>
<a href=https://static.grinnell.edu/dlad-blog/images/post-120/oai_dc-problem.png itemprop=contentUrl></a>
<figcaption><h4>Problematic OAI Export Sample</h4>
</figcaption>
</figure>
</div>
<p>If this is indeed the root of the problem, then my prayer (üôè) is that removing all unnecessary <code>&lt;dc:identifier></code> <code>u1:</code> and <code>u2:</code> elements will make the problem go away. üçÄ</p>
<p>And that&rsquo;s a wrap. Until next time, stay safe and wash your hands! üòÑ</p>
</div>
<div class=post-footer>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//digital-library-applications-developer-blog.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</article>
</main>
</body>
</html>