<!doctype html><html lang=en-us><head><title>Exporting, Editing & Replacing MODS Datastreams: Updated Technical Details // The Grinnell College Digital Library Application Developer's Blog</title><meta charset=utf-8><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Mark A. McFate"><meta name=description content><link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.bc1abb622a656fb4c816fed09d36c15e272b31b7beae2e7113b2f9418bff0361.css><script type=text/javascript src=https://static.grinnell.edu/dlad-blog/js/pdf-js/build/pdf.js></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Exporting, Editing & Replacing MODS Datastreams: Updated Technical Details"><meta name=twitter:description content="Attention: On 21-May-2020 an optional, but recommended, sixth step was added to this workflow in the form of a new _Drush_ command: _islandora\_mods_post\_processing_, an addition to my previous work in [islandora_mods_via_twig](https://github.com/DigitalGrinnell/islandora_mods_via_twig). See my new post, [Islandora MODS Post Processing](/posts/075-islandora-mods-post-processing/) for complete details. Attention: In November 2021 a recommended seventh step was added to this workflow. That addition is documented in the final section of this document. A 7-Step Workflow This document is follow-up, with technical details, to Exporting, Editing & Replacing MODS Datastreams, post 069, in my blog."><meta property="og:title" content="Exporting, Editing & Replacing MODS Datastreams: Updated Technical Details"><meta property="og:description" content="Attention: On 21-May-2020 an optional, but recommended, sixth step was added to this workflow in the form of a new _Drush_ command: _islandora\_mods_post\_processing_, an addition to my previous work in [islandora_mods_via_twig](https://github.com/DigitalGrinnell/islandora_mods_via_twig). See my new post, [Islandora MODS Post Processing](/posts/075-islandora-mods-post-processing/) for complete details. Attention: In November 2021 a recommended seventh step was added to this workflow. That addition is documented in the final section of this document. A 7-Step Workflow This document is follow-up, with technical details, to Exporting, Editing & Replacing MODS Datastreams, post 069, in my blog."><meta property="og:type" content="article"><meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/115-exporting-editing-replacing-mods-datastreams-updated-technical-details/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-14T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-14T00:00:00+00:00"><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://analytics.summittservices.com/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","16"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></head><body><header class=app-header><a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a><h2>The Grinnell College Digital Library Application Developer's Blog</h2><div class=author-block><p class=site-rev>Compiled: May 10, 2023 at 9:25am CDT<br>Content Updated: 2023-May-10 08:22 CDT</p><div class=name>by
<strong>Mark A. McFate</strong></div><div class=address>Grinnell College Libraries</div><div class=link><a href=mailto:></a></div><br></div><nav class=sidebar-nav><a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a></nav><p class=site-description>Mark&rsquo;s first Hugo site, a blog, formerly on prem at Static.Grinnell.edu, moved to <em>DigitalOcean</em>, then to <em>Azure</em>, and now hosted on <em>GitHub Pages</em>.</p><div class=app-header-social><a target=_blank href=https://github.com/McFateM><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/gohugoio><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div><p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p></header><main class=app-container><div class=breadcrumbs><a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/115-exporting-editing-replacing-mods-datastreams-updated-technical-details/>115 exporting editing replacing mods datastreams updated technical details</a></div><article class=post><header class=post-header><h1 class=post-title>Exporting, Editing & Replacing MODS Datastreams: Updated Technical Details</h1><div class=post-meta><script>console.log("Hugo Debug: ",JSON.parse('"2021-12-15T00:00:00Z"'))</script><script>console.log("Hugo Debug: ",JSON.parse('"2021-12-14T00:00:00Z"'))</script><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>9 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Dec 14, 2021
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/mods/>MODS</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/export/>Export</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/replace/>Replace</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/twig/>Twig</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/islandora_datastream_export/>islandora_datastream_export</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/islandora_datastream_replace/>islandora_datastream_replace</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/islandora_mods_via_twig/>islandora_mods_via_twig</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/map-mods-to-master/>Map-MODS-to-MASTER</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/islandora_mods_post_processing/>islandora_mods_post_processing</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/reduce-mods-remainders/>reduce-MODS-remainders</a></div></div><div class=annotation><p style=font-size:1.6em><strong>Attention</strong>: This post supersedes <strong><a href=https://static.grinnell.edu/dlad-blog/posts/070-exporting-editing-replacing-mods-datastreams-technical-details/>posts/070-exporting-editing-replacing-mods-datastreams-technical-details</a></strong>.</p></div></header><div class=post-content><p><div class=annotation><b>Attention:</b> On 21-May-2020 an optional, but recommended, sixth step was added to this workflow in the form of a new _Drush_ command: _islandora\_mods_post\_processing_, an addition to my previous work in [islandora_mods_via_twig](https://github.com/DigitalGrinnell/islandora_mods_via_twig). See my new post, [Islandora MODS Post Processing](/posts/075-islandora-mods-post-processing/) for complete details.</div></p><p><div class=annotation><b>Attention:</b> In November 2021 a recommended seventh step was added to this workflow. That addition is documented in the final section of this document.</div></p><h1 id=a-7-step-workflow>A 7-Step Workflow</h1><p>This document is follow-up, with technical details, to <a href=https://static.grinnell.edu/dlad-blog/posts/069-exporting-editing-replacing-mods-datastreams/>Exporting, Editing & Replacing MODS Datastreams</a>, post 069, in my blog. In case you missed it, the aforementioned post was written specifically for metadata editors working on the 2020 <em>Grinnell College Libraries</em> review of <em>Digital Grinnell</em> MODS metadata.</p><p>Attention: This document uses a shorthand <code>./</code> in place of the frequently referenced <code>//STORAGE/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1/</code> directory. For example, <code>./social-justice</code> is equivalent to the <em>Social Justice</em> collection sub-directory at <code>//STORAGE/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1/social-justice</code>.</p><p>Briefly, the seven steps in this workflow are:</p><ol><li><p>Export of all <code>grinnell:*</code> <em>MODS</em> datastreams using <code>drush islandora_datastream_export</code>. This step, last performed on April 14, 2020, was responsible for creating all of the <code>grinnell_&lt;PID>_MODS.xml</code> exports found in <code>./&lt;collection-PID></code>.</p></li><li><p>Execute my <em>Map-MODS-to-MASTER</em> <em>Python 3</em> script on iMac <em>MA8660</em> to create a <code>mods.tsv</code> file for each collection, along with associated <code>grinnell_&lt;PID>_MODS.log</code> and <code>grinnell_&lt;PID>_MODS.remainder</code> files for each object. The resultant <code>./&lt;collection-PID>/mods.tsv</code> files are tab-seperated-value (.tsv) files, and they are <strong>key</strong> to this process.</p></li><li><p>Edit the MODS .tsv files. Refer <a href=https://static.grinnell.edu/dlad-blog/posts/069-exporting-editing-replacing-mods-datastreams/>Exporting, Editing, & Replacing MODS Datastreams</a> for details and guidance.</p></li><li><p>Use <code>drush islandora_mods_via_twig</code> in each ready-for-update collection to generate new .xml MODS datastream files. For a specified collection, this command will find and read the <code>./&lt;collection-PID>/mods-imvt.tsv</code> and create one <code>./&lt;collection-PID>/ready-for-datastream-replace/grinnell_&lt;PID>_MODS.xml</code> file for each object.</p></li><li><p>Execute the <code>drush islandora_datastream_replace</code> command once for each collection. This command will process each <code>./&lt;collection-PID>/ready-for-datastream-replace/grinnell_&lt;PID>_MODS.xml</code> file and replace the corresponding object&rsquo;s MODS datastream with the contents of the .xml file. The <em>digital_grinnell</em> branch version of the <code>islandora_datastream_replace</code> command also performs an implicit update of the object&rsquo;s &ldquo;Title&rdquo;, a transform of the new MODS to DC (<em>Dublin Core</em>), and a re-indexing of the new metadata in <em>Solr</em>.</p></li><li><p>Execute an optional follow-up <code>drush</code> command as documented in <a href=https://static.grinnell.edu/dlad-blog/posts/075-islandora-mods-post-processing/>Islandora MODS Post Processing</a>. This portion of the workflow will help to reduce duplication of effort for objects that are shared between two or more collections.</p></li><li><p>Configure and run the <code>main.py</code> script as described in the <code>README.md</code> file at my <a href=https://github.com/Digital-Grinnell/reduce-MODS-remainders>reduce-MODS-remainders</a> repository. This portion of the workflow will analyze all of the <code>*.remainders</code> files left behind by worflow <em>Step 2</em> for objects in a given collection.</p></li></ol><p>The remainder of this document provides technical details, frequently in the form of command lines used to build and use the aforementioned tools.</p><h2 id=step-1a---installation-of-drush-islandora_datastream_export-and-islandora_datastream_replace-commands>Step 1a - Installation of Drush <code>islandora_datastream_export</code> and <code>islandora_datastream_replace</code> Commands</h2><p>To help implement this process efficiently and effectively I first turned to <a href=https://github.com/calhist/documentation/wiki/Exporting,-Editing,-&-Replacing-MODS-Datastreams>Exporting, Editing, & Replacing MODS Datastreams</a>, a workflow developed by the good folks at <a href=https://californiahistoricalsociety.org/>The California Historical Society</a>. I initiated the workflow by installing two <em>Drush</em> tools on my <a href=https://dg.localdomain>local/development instance</a> of <a href=https://github.com/Islandora-Collaboration-Group/ISLE>ISLE</a> on my Mac workstation.</p><p>The command line process in my local host/workstation terminal looked like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Apache<span style=color:#f92672>=</span>isle-apache-ld
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/all/modules/islandora/ <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> git clone https://github.com/Islandora-Labs/islandora_datastream_exporter.git --recursive
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/all/modules/islandora/ <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> git clone https://github.com/pc37utn/islandora_datastream_replace.git --recursive
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/all/modules/islandora/ <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> chown -R islandora:www-data *
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/default <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> drush en islandora_datastream_exporter islandora_datastream_replace -y
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/default <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> drush cc drush -y
</span></span></code></pre></div><p>Local tests of these commands were successful so I proceeded to install them in the production instance of <em>Digital Grinnell</em> at <em>dgdocker1.grinnell.edu</em>. Before doing that I needed to change the definition of <code>Apache</code> to reflect the production instance of our <em>Apache</em> container, like so <code>Apache=isle-apache-dg</code>.</p><h3 id=created-a-fork-of-_islandora-datastream-replace_>Created a Fork of <em>Islandora Datastream Replace</em></h3><p>I also chose to &ldquo;fork&rdquo; the <em>islandora_datastream_replace</em> project so that I could do a little <em>Digital.Grinnell</em> customization of it. The fork I&rsquo;m working with is <a href=https:/github.com/DigitalGrinnell/islandora_datastream_replace>here</a> and my work is limited to the <a href=https://github.com/DigitalGrinnell/islandora_datastream_replace/tree/digital_grinnell>digital_grinnell</a> branch of that fork.</p><p>In the <a href=https://github.com/DigitalGrinnell/islandora_datastream_replace/tree/digital_grinnell>digital_grinnell</a> branch I modified the behavior of the <em>islandora_datastream_replace</em> command so that it implicitly performs an <code>UpdateFromMODS</code> operation that lives in our <a href=https:/github.com/DigitalGrinnell/idu>idu, or Islandora Drush Utilities</a> module. The <code>UpdateFromMODS</code>, performed immediately after each datastream replace operation does the following:</p><ul><li>Updates the object &ldquo;Title&rdquo;, one of its properties, to match the new value of <code>/mods:mods/mods:titleInfo[not(@type)]/mods:title</code>.</li><li>Invokes the <code>iduF DCTransform</code> operation which runs the default XSLT transform of the new MODS to DC (<em>Dublin Core</em>) and creates a new &ldquo;DC&rdquo; datastream for the object.</li><li>The <code>iduF DCTransform</code> operation also concludes with an implicit <code>iduF IndexSolr</code> operation to ensure that the new object metadata is properly indexed in <em>Solr</em>.</li></ul><h2 id=step-1b---installation-of-drush-islandora_datastream_export-and-islandora_datastream_replace-commands-in-production>Step 1b - Installation of Drush <code>islandora_datastream_export</code> and <code>islandora_datastream_replace</code> Commands in Production</h2><p>To install the commands in production I opened a terminal to <em>dgdocker1.grinnell.edu</em> as user <em>islandora</em> and executed the following commands there:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Apache<span style=color:#f92672>=</span>isle-apache-dg
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/all/modules/islandora/ <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> git clone https://github.com/Islandora-Labs/islandora_datastream_exporter.git --recursive
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/all/modules/islandora/ <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> git clone https://github.com/DigitalGrinnell/islandora_datastream_replace.git --recursive
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/all/modules/islandora/ <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> chown -R islandora:www-data *
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/all/modules/islandora/islandora_datastream_replace <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> git checkout -b digital_grinnell
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/default <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> drush en islandora_datastream_exporter islandora_datastream_replace -y
</span></span><span style=display:flex><span>docker exec -w /var/www/html/sites/default <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> drush cc drush -y
</span></span></code></pre></div><h2 id=step-1c---mounting-storage-to-dgdocker1>Step 1c - Mounting //STORAGE to DGDocker1</h2><p>Attention! This step, and some that come later, will require that the network storage path <code>//STORAGE/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1</code> be accessible to our production instance of <em>Digital.Grinnell</em>. To make that possible I had to run this sequence on <em>DGDocker1</em>:</p><blockquote><p>docker exec -it isle-apache-dg bash
mount -t cifs -o username=mcfatem /storage.grinnell.edu/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1 /mnt/metadata-review /mnt/metadata-review</p></blockquote><h2 id=step-1d---using-drush-islandora_datastream_export>Step 1d - Using Drush <code>islandora_datastream_export</code></h2><p>Unfortunately, the <code>islandora_datastream_export</code> results in my local test were woefully incomplete&mldr; NONE of the child objects with a compound parent were exported. I&rsquo;m still not entirely sure why child obejcts were omitted since the query I used should have captured all objects. In testing I did find that this seems to be a flaw in the <em>islandora_datastream_export</em> command, and specifically in its implementation of any <em>Solr</em> query.</p><p>Fortunately, the aforementioned command also has a <em>SPARQL</em> query option, and after some trial-and-error I got it to work properly. To do so I created an <code>export.sh</code> <em>bash</em> script, shown below, and used it on <em>dgdocker1.grinnell.edu</em> like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it isle-apache-dg bash
</span></span><span style=display:flex><span>source export.sh
</span></span></code></pre></div><p>The <code>export.sh</code> script is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-export.sh data-lang=export.sh><span style=display:flex><span>Apache<span style=color:#f92672>=</span>isle-apache-dg
</span></span><span style=display:flex><span>Target<span style=color:#f92672>=</span>/utility-scripts
</span></span><span style=display:flex><span><span style=color:#75715e># wget https://gist.github.com/McFateM/5bd7e5b0fa5d2928b2799d039a4c0fab/raw/collections.list</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> read collection
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    cp -f ri-query.txt query.sparql
</span></span><span style=display:flex><span>    sed -i <span style=color:#e6db74>&#39;s|COLLECTION|&#39;</span><span style=color:#e6db74>${</span>collection<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;|g&#39;</span> query.sparql
</span></span><span style=display:flex><span>    docker cp query.sparql <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span>:<span style=color:#e6db74>${</span>Target<span style=color:#e6db74>}</span>/<span style=color:#e6db74>${</span>collection<span style=color:#e6db74>}</span>.sparql
</span></span><span style=display:flex><span>    rm -f query.sparql
</span></span><span style=display:flex><span>    q<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>Target<span style=color:#e6db74>}</span>/<span style=color:#e6db74>${</span>collection<span style=color:#e6db74>}</span>.sparql
</span></span><span style=display:flex><span>    echo Processing collection <span style=color:#e6db74>&#39;${collection}&#39;</span>; Query is <span style=color:#e6db74>&#39;${q}&#39;</span>...
</span></span><span style=display:flex><span>    docker exec -w <span style=color:#e6db74>${</span>Target<span style=color:#e6db74>}</span> <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> mkdir -p /mnt/metadata-review/<span style=color:#e6db74>${</span>collection<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>    docker exec -w /var/www/html/sites/default/ <span style=color:#e6db74>${</span>Apache<span style=color:#e6db74>}</span> drush -u <span style=color:#ae81ff>1</span> islandora_datastream_export --export_target<span style=color:#f92672>=</span>/mnt/metadata-review/<span style=color:#e6db74>${</span>collection<span style=color:#e6db74>}</span> --query<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>q<span style=color:#e6db74>}</span> --query_type<span style=color:#f92672>=</span>islandora_datastream_exporter_ri_query  --dsid<span style=color:#f92672>=</span>MODS
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span> &lt; collections.list
</span></span></code></pre></div><p>In the case of the <em>Digital Grinnell</em> <em>social-justice</em> collection, for example, this script produced 32 <em>.xml</em> files, the correct number. Each collection&rsquo;s set of exported <em>.xml</em> files can be found in the collection-specific subdirectory of <code>//STORAGE/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1/</code> and all have filenames of the form: <code>grinnell_&lt;PID>_MODS.xml</code>. Note that objects which have no MODS datastream were not exported.</p><h2 id=step-2---_map-mods-to-master_-_python-3_-script>Step 2 - <em>Map-MODS-to-MASTER</em> <em>Python 3</em> Script</h2><p>The <em>Map-MODS-to-MASTER</em> script was developed, in <em>Python 3</em>, on iMac <em>MA8660</em> at <code>~/GitHub/Map-MODS-to-MASTER</code> to facilitate generation of <code>mods.tsv</code> and accompanying <code>.log</code> files for each <em>Digital Grinnell</em> collection from the <code>.xml</code> files found in subdirectories of <code>//STORAGE/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1/</code>.</p><p>The <em>Map-MODS-to-MASTER</em> project can be found in the <em>master</em> branch of <a href=https://github.com/DigitalGrinnell/Map-MODS-to-MASTER>https://github.com/DigitalGrinnell/Map-MODS-to-MASTER</a>. I choose to execute it using <em>PyCharm</em> from iMac <em>MA8660</em> since the directory holding all of the <code>.xml</code> files and folders is already mapped to <code>/Volumes/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1</code> on that iMac. Note that this <code>//STORAGE</code> location was choosen because the <code>./ALLSTAFF</code> directory, and its subordinates, are accessible to all staff in the <em>Grinnell College Libraries</em>.</p><p>It should not be necessary to run this script ever again&mldr;NEVER. However, if it becomes necessary to look back at this code and process, details can be found in <a href=https://github.com/DigitalGrinnell/Map-MODS-to-MASTER>Map-MODS-to-MASTER</a>. Note: If it should ever become necessary to repeat the <em>Map-MODS-to-MASTER</em> process it might be wise to look at replacing the <em>Python 3</em> script with a new <em>Drush</em> command, maybe <code>islandora_map_mods_to_master</code>, written in PHP and installed directly into the production instance of <em>Digital.Grinnell</em>.</p><h2 id=step-3---editing-the-mods-tsv-files>Step 3 - Editing the MODS .tsv Files</h2><p>Please refer to Refer to <a href=https://static.grinnell.edu/dlad-blog/posts/069-exporting-editing-replacing-mods-datastreams/>Exporting, Editing, & Replacing MODS Datastreams</a>, post 069 in my blog, for details and guidance.</p><h2 id=step-4---run-drush-islandora_mods_via_twig>Step 4 - Run <code>drush islandora_mods_via_twig</code></h2><p>As each individual collection <code>mods-imvt.tsv</code> file is made ready-for-update, it will be necessary to run a <code>drush islandora_mods_via_twig</code> command to process the .tsv data. Running <code>--help</code> with that command produces:</p><pre tabindex=0><code>[islandora@dgdocker1 ~]$ docker exec -it isle-apache-dg bash
root@122092fe8182:/# cd /var/www/html/sites/default/
root@122092fe8182:/var/www/html/sites/default# drush -u 1 islandora_mods_via_twig --help
Generate MODS .xml files from the mods-imvt.tsv file for a specified collection.

Examples:
 drush -u 1 islandora_mods_via_twig social-justice   Process ../social-justice/mods-imvt.tsv, for example.

Arguments:
 collection             The name of the collection to be processed.  Defaults to &#34;social-justice&#34;.

Aliases: imvt
</code></pre><p>So, my command sequence to run <code>islandora_mods_via_twig</code> for the &ldquo;Social Justice&rdquo; collection, as an example, was:</p><pre tabindex=0><code>[islandora@dgdocker1 ~]$ docker exec -it isle-apache-dg bash
root@122092fe8182:/# cd /var/www/html/sites/default/
root@122092fe8182:/var/www/html/sites/default# drush -u 1 islandora_mods_via_twig social-justice
</code></pre><p>When the <code>islandora_mods_via_twig</code> command is run, it processes the corresponding <code>//STORAGE/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1/&lt;collection-PID>/mods-imvt.tsv</code> file and creates one <code>//STORAGE/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1/&lt;collection-PID>/ready-for-datastream-replace/grinnell_&lt;PID>_MODS.xml</code> file for each object.</p><h2 id=step-5---run-drush-islandora_datastream_replace>Step 5 - Run <code>drush islandora_datastream_replace</code></h2><p>The whole point of this entire process is to get us back to this point with a set of reviewed and modified <em>.xml</em> files in a <code>//STORAGE/LIBRARY/ALLSTAFF/DG-Metadata-Review-2020-r1/&lt;collection-PID>/ready-for-datastream-replace/</code> collection-specific subdirectory so that we can replace existing object MODS datastreams with new data, and we use the <code>drush islandora_datastream_replace</code> command to do this.</p><p>Running <code>--help</code> for the aformentioned command produced this:</p><pre tabindex=0><code>root@122092fe8182:/var/www/html/sites/default# drush -u 1 islandora_datastream_replace --help
Replaces a datastream in all objects given a file list in a directory.

Examples:
 drush -u 1 islandora_datastream_replace --source=/mnt/metadata-review/social-justice/ready-for-datastream-replace
 --dsid=MODS --namespace=grinnell

   Replacing MODS datastream for objects in --source using the digital_grinnell branch of code.

Options:
 --dsid                                    The datastream id of the datastream. Required.
 --namespace                               The namespace of the pids. Required.
 --source                                  The directory to get the datastreams and pid# from. Required.

Aliases: idre
</code></pre><p>It&rsquo;s worth noting that this command looks for any files named <em><em>MODS</em></em> in whatever <em>ABSOLUTE</em> directory is named with the <code>--source</code> parameter. The command shown below was executed inside the <em>Apache</em> container, <em>isle-apache-dg</em>, on node <em>DGDocker1</em>, in order to process <em>Digital Grinnell</em>&rsquo;s <em>social-justice</em> collection.</p><pre tabindex=0><code>root@122092fe8182:drush -u 1 islandora_datastream_replace --source=/mnt/metadata-review/social-justice/ready-for-datastream-replace --dsid=MODS --namespace=grinnell
</code></pre><p>The same command could have been executed directly from node <em>DGDocker1</em> like so:</p><pre tabindex=0><code>docker exec isle-apache-dg drush -u 1 -w /var/www/html/sites/default drush -u 1 islandora_datastream_replace --source=mnt/metadata-review/social-justice/ready-for-datastream-replace --dsid=MODS --namespace=grinnell
</code></pre><h2 id=step-6---reduce-duplicates>Step 6 - Reduce Duplicates</h2><p>As mentioned in the summary above, this is an optional but recommended follow-up <code>drush</code> command described in <a href=https://static.grinnell.edu/dlad-blog/posts/075-islandora-mods-post-processing/>Islandora MODS Post Processing</a>.</p><h2 id=step-7---analyze-and-restore-remainder-fields>Step 7 - Analyze and Restore &ldquo;remainder&rdquo; Fields</h2><p>As mentioned in the summary above, this step is designed to analyze all of the <code>*.remainder</code> files left behind by workflow <em>Step 2</em> for objects in a given collection, and provide commands to restore legitimate elements after review. Follow instructions found in the <code>README.md</code> file at my <a href=https://github.com/Digital-Grinnell/reduce-MODS-remainders>reduce-MODS-remainders</a> repository.</p><p>And that&rsquo;s a wrap. Until next time, stay safe and wash your hands! ðŸ˜„</p></div><div class=post-footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//digital-library-applications-developer-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></main></body></html>