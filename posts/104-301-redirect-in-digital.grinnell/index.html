<!doctype html><html lang=en-us>
<head>
<title>301 Redirect in Digital.Grinnell // The Grinnell College Digital Library Application Developer's Blog</title>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.92.2">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Mark A. McFate">
<meta name=description content>
<link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.9c8221604a940e564cde94099293f4503b8b80211850f796925232baa766af02.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="301 Redirect in Digital.Grinnell">
<meta name=twitter:description content="A colleague and I were recently sifting through the Digital.Grinnell logs and came across some recurring 404, &ldquo;page not found&rdquo;, status messages. 404&rsquo;s are not uncommon in DG, but these were particularly troubling because they were requests of the form drupal/fedora/repository/grinnell:162 and drupal/fedora/repository/grinnell:86. That&rsquo;s the old, and by that I mean VERY OLD, like Drupal v6 vintage from 2012 or 2013, form for an object address. All such references were to some of DG&rsquo;s oldest digital objects, too.
We tried to figure out where such old address references might be coming from, but we struck out.">
<meta property="og:title" content="301 Redirect in Digital.Grinnell">
<meta property="og:description" content="A colleague and I were recently sifting through the Digital.Grinnell logs and came across some recurring 404, &ldquo;page not found&rdquo;, status messages. 404&rsquo;s are not uncommon in DG, but these were particularly troubling because they were requests of the form drupal/fedora/repository/grinnell:162 and drupal/fedora/repository/grinnell:86. That&rsquo;s the old, and by that I mean VERY OLD, like Drupal v6 vintage from 2012 or 2013, form for an object address. All such references were to some of DG&rsquo;s oldest digital objects, too.
We tried to figure out where such old address references might be coming from, but we struck out.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/104-301-redirect-in-digital.grinnell/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-04-14T00:00:00+00:00">
<meta property="article:modified_time" content="2021-04-14T10:28:31-05:00">
</head>
<body>
<header class=app-header>
<a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a>
<h2>The Grinnell College Digital Library Application Developer's Blog</h2>
<div class=author-block>
<p class=site-rev>
Compiled: Feb 18, 2022 at 1:42pm CST<br>
Content Updated: 2022-Feb-18 00:00 UTC
</p>
<div class=name>by
<strong>Mark A. McFate</strong></div>
<div class=address>Grinnell College Libraries</div>
<div class=link><a href=mailto:></a></div>
<br>
</div>
<nav class=sidebar-nav>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a>
</nav>
<p class=site-description>Mark's first Hugo site, a blog, formerly at Static.Grinnell.edu, moved to DigitalOcean, and now hosted on Azure.</p>
<div class=app-header-social>
<a target=_blank href=https://github.com/McFateM><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>
<a target=_blank href=https://twitter.com/gohugoio><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a>
</div>
<p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p>
</header>
<main class=app-container>
<div class=breadcrumbs>
<a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/104-301-redirect-in-digital.grinnell/>104 301 redirect in digital.grinnell</a>
</div>
<article class=post>
<header class=post-header>
<h1 class=post-title>301 Redirect in Digital.Grinnell</h1>
<div class=post-meta>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Apr 14, 2021
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=https://static.grinnell.edu/dlad-blog/tags/301/>301</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/redirect/>Redirect</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/apache/>Apache</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/.htaccess/>.htaccess</a></div></div>
</header>
<div class=post-content>
<p>A colleague and I were recently sifting through the <a href=https://digital.grinnell.edu>Digital.Grinnell</a> logs and came across some recurring 404, &ldquo;page not found&rdquo;, status messages. 404&rsquo;s are not uncommon in <em>DG</em>, but these were particularly troubling because they were requests of the form <code>drupal/fedora/repository/grinnell:162</code> and <code>drupal/fedora/repository/grinnell:86</code>. That&rsquo;s the old, and by that I mean VERY OLD, like <em>Drupal v6</em> vintage from 2012 or 2013, form for an object address. All such references were to some of <em>DG</em>&rsquo;s oldest digital objects, too.</p>
<p>We tried to figure out where such old address references might be coming from, but we struck out. I wonder if it&rsquo;s even possible to back-track a request like that given today&rsquo;s <a href=https://www.privacypolicies.com/blog/gdpr-privacy-policy/>GDPR</a> environment and related privacy practices?</p>
<p>So, in lieu of finding the source of these requests, I did a little research and found <a href=https://www.drupal.org/node/38960>
Redirecting specific pages to new URLs (301 redirects in Drupal)
</a>. It didn&rsquo;t take long to implement an <em>Apache</em> redirect rule based on this document, so that&rsquo;s what I did. I first implemented a new rule in the <code>/var/www/html/.htaccess</code> file on our staging server, <code>https://dg-staging.grinnell.edu</code>, and tested it there. It works nicely, so I pushed the change to production and tested again. Works well there too!</p>
<h2 id=the-301-redirect-rule>The 301 Redirect Rule</h2>
<p>The addition I made, per the aforementioned document are currently lines 115-124 in <a href=https://github.com/Digital-Grinnell/dg-islandora/blob/main/.htaccess>https://github.com/Digital-Grinnell/dg-islandora/blob/main/.htaccess</a>. Like so:</p>
<pre tabindex=0><code>RewriteBase /

  ## The following rule lifted from https://www.drupal.org/node/38960
  ## Implemented in April 2021 in order to redirect old object addresses of the form
  ##   drupal/fedora/repository/grinnell:182, to a proper equivalent form like
  ##   islandora/object/grinnell:182
  ##
  # custom redirects
  RewriteRule ^drupal/fedora/repository/(.+)$ https://digital.grinnell.edu/islandora/object/$1 [R=301,L]
  # end custom redirects
</code></pre><p>I used an <a href=https://httpd.apache.org/docs/2.4/rewrite/intro.html>Apache mod_rewrite Introduction</a> document to refresh my memory regarding <em>Apache</em> rewrite rules and syntax.</p>
<p>Note that the <code>RewriteBase /</code> statement was already in the <code>.htaccess</code> file, but it was previously commented out. I saw no harm in activating it, and the document somewhat suggests it should be turned on, so I removed the comment and added the 9 lines that follow it.</p>
<h2 id=a-definite-plus>A Definite Plus</h2>
<p>One of the things I like most about this solution is reflected in a statement lifted from <a href=https://www.drupal.org/node/38960>301 redirects in Drupal)</a>, specifically:</p>
<div class=original><p>&mldr;301 redirects are considered the best way to handle redirected pages, for they inform search engines to update their databases with the new paths. This way, you should not risk your search engine pagerank or lose site visitors with 404 &ldquo;not found&rdquo; errors.</p>
</div>
<h2 id=not-great-but-it-works>Not Great, But It Works</h2>
<p>I say it&rsquo;s not a &ldquo;great&rdquo; rule because it assumes anything passed to <em>DG</em> with <code>drupal/fedora/repository/...</code> in the address should be redirected to <code>https://digital.grinnell.edu/islandora/object/...</code> and that&rsquo;s not explicitly true when I&rsquo;m working with our staging server, but the intent is to fix a condition that should only exist in production, so it will do. I did try some more advanced substitution (see below), but it didn&rsquo;t work, so I returned to a simple substitution that does work in production.</p>
<h3 id=advanced-rule-fails>Advanced Rule Fails</h3>
<p>This rule, <code>RewriteRule ^(.+)/drupal/fedora/repository/(.+)$ $1/islandora/object/$2 [R=301,L]</code>, seemed like a better rule since it doesn&rsquo;t assume the host is <code>https://digital.grinnell.edu</code>, but it doesn&rsquo;t work properly. I&rsquo;m betting some more <code>RewriteCond</code> rules would be required to make it so.</p>
<h2 id=test-it>Test It?</h2>
<p>If you&rsquo;d care to test the new rule, just take any of these URLs for a spin in your browser:</p>
<ul>
<li><a href=https://digital.grinnell.edu/drupal/fedora/repository/grinnell:86>https://digital.grinnell.edu/drupal/fedora/repository/grinnell:86</a></li>
<li><a href=https://digital.grinnell.edu/drupal/fedora/repository/grinnell:182>https://digital.grinnell.edu/drupal/fedora/repository/grinnell:182</a></li>
</ul>
<p>And that&rsquo;s a wrap. Until next time, happy redirecting!</p>
</div>
<div class=post-footer>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//digital-library-applications-developer-blog.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</article>
</main>
</body>
</html>