<!doctype html><html lang=en-us>
<head>
<title>Migration to Lando // The Grinnell College Digital Library Application Developer's Blog</title>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.88.1">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Mark A. McFate">
<meta name=description content>
<link rel=stylesheet href=/css/main.8a32dadea1834ef74fe59f5362dbaaa416e123d8600158d361ad3d96945c0aa5.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Migration to Lando">
<meta name=twitter:description content="I have ITS tickets, for seemingly simple DNS changes, that are now more than a month old, and because of that I&rsquo;ve taken steps to try and do some ISLE staging work on one of my DigitalOcean droplets, namely summitt-services-droplet-01. In order to accommodate that I&rsquo;ve moved nearly all of the sites and services from that droplet to my other, summitt-dweller-DO-docker. The site migration was a smooth process except for https://Wieting.TamaToledo.com. That Drupal 8 site has been difficult to upgrade and migrate largely because it was deployed using my old Port-Ability scripts, and about a year ago I scrapped Port-Ability in favor of Docksal, but I never got around to moving that particular site to a Docksal environment.">
<meta property="og:title" content="Migration to Lando">
<meta property="og:description" content="I have ITS tickets, for seemingly simple DNS changes, that are now more than a month old, and because of that I&rsquo;ve taken steps to try and do some ISLE staging work on one of my DigitalOcean droplets, namely summitt-services-droplet-01. In order to accommodate that I&rsquo;ve moved nearly all of the sites and services from that droplet to my other, summitt-dweller-DO-docker. The site migration was a smooth process except for https://Wieting.TamaToledo.com. That Drupal 8 site has been difficult to upgrade and migrate largely because it was deployed using my old Port-Ability scripts, and about a year ago I scrapped Port-Ability in favor of Docksal, but I never got around to moving that particular site to a Docksal environment.">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/064-migration-to-lando/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-02-17T00:00:00+00:00">
<meta property="article:modified_time" content="2020-02-20T22:25:11-06:00">
</head>
<body>
<header class=app-header>
<a href><img class=app-header-avatar src=/avatar.jpg alt="Mark A. McFate"></a>
<h2>The Grinnell College Digital Library Application Developer's Blog</h2>
<div class=author-block>
<p class=site-rev>
Compiled: Oct 5, 2021 at 6:46pm CDT<br>
Content Updated: 2021-Oct-5 18:35 CDT
</p>
<div class=name>by
<strong>Mark A. McFate</strong></div>
<div class=address>Grinnell College Libraries</div>
<div class=link><a href=mailto:></a></div>
<br>
</div>
<nav class=sidebar-nav>
<a class=sidebar-nav-item href=/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=/about/ title>About Me</a>
</nav>
<p class=site-description>Mark's first Hugo site, a blog, formerly at Static.Grinnell.edu, moved to DigitalOcean, and now hosted on Azure.</p>
<div class=app-header-social>
<a target=_blank href=https://github.com/McFateM><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>
<a target=_blank href=https://twitter.com/gohugoio><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a>
</div>
<p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p>
</header>
<main class=app-container>
<div class=breadcrumbs>
<a href>Home</a>
&bull; <a href=posts/>Posts</a>
&bull; <a href=posts/064-migration-to-lando/>064 migration to lando</a>
</div>
<article class=post>
<header class=post-header>
<h1 class=post-title>Migration to Lando</h1>
<div class=post-meta>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
28 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Feb 17, 2020
&nbsp;&nbsp;&bull;&nbsp;&nbsp;Updated: Feb 20, 2020 - 22:25
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=/tags/docksal/>docksal</a><a class=tag href=/tags/lando/>Lando</a><a class=tag href=/tags/wieting/>Wieting</a><a class=tag href=/tags/mogtofu33/>mogtofu33</a><a class=tag href=/tags/docker-compose-drupal/>docker-compose-drupal</a></div></div>
</header>
<div class=post-content>
<p>I have ITS tickets, for seemingly simple DNS changes, that are now more than a month old, and because of that I&rsquo;ve taken steps to try and do some <em>ISLE</em> staging work on one of my <em>DigitalOcean</em> droplets, namely <em>summitt-services-droplet-01</em>. In order to accommodate that I&rsquo;ve moved nearly all of the sites and services from that droplet to my other, <em>summitt-dweller-DO-docker</em>. The site migration was a smooth process except for <a href=https://wieting.tamatoledo.com>https://Wieting.TamaToledo.com</a>. That <em>Drupal 8</em> site has been difficult to upgrade and migrate largely because it was deployed using my old <em>Port-Ability</em> scripts, and about a year ago I scrapped <em>Port-Ability</em> in favor of <a href=https://docksal.io>Docksal</a>, but I never got around to moving that particular site to a <em>Docksal</em> environment. Well, now I&rsquo;m finding it almost impossible to complete that migration to <em>Docksal</em>.</p>
<h1 id=the-problem-with-docksal>The Problem with Docksal</h1>
<p><em>Docksal</em> is a wonderful development environment, but I can&rsquo;t find an effective, and easily repeatable, path from development to production when using it. <em>Docksal</em> provides system services including an <code>SSH Agent</code>, <code>DNS</code>, and <code>Reverse Proxy</code> as documented <a href=https://docs.docksal.io/core/overview/>here</a>. <em>Docksal</em> services are provided by a <code>cli</code> container/service which is also responsible for providing a robust set of <code>fin</code> commands. In addition to <code>cli</code>, a typical <em>Docksal</em> stack also provides containers for <code>web</code> and <code>db</code>, and those look a lot like what I like to deploy for <em>Drupal</em> in production. However, the <code>cli</code> container looks nothing like what I deploy in production, and therein lies the rub.</p>
<h1 id=the-promise-of-lando>The Promise of Lando</h1>
<p>Hindsight is 20/20, so this must be the year to look back and make course corrections, right? Had I not fallen so quickly for the speed and glitz of <em>Docksal</em> I would have given some of its alternatives, like <a href=https://lando.dev>Lando</a>, a closer look. The immediate promise of <em>Lando</em> is that it builds, in development, a stack that looks much more like what I wish to deploy in production, and it does so by not integrating as tightly as <em>Docksal</em> does.</p>
<h1 id=migrating-the-wieting-theatre-web-site-to-lando>Migrating the Wieting Theatre Web Site to Lando</h1>
<p>Another thing that I like about <em>Lando</em> is the fact that <a href=https://www.jeffgeerling.com>Jeff Geerling</a> has taken it for a spin and documented some of his experience with it in his blog. So I have elected to begin my adventures in <em>Lando</em> with <a href=https://www.jeffgeerling.com/blog/2018/getting-started-lando-testing-fresh-drupal-8-umami-site>this post</a>.</p>
<p>After following Jeff&rsquo;s lead I discovered that it left me a little short of my goal&mldr; to spin up an <strong>existing</strong> <em>Drupal 8</em> site using <em>Lando</em>. So, I backed off a bit and returned to studying the contents of <a href=https://github.com/lando/lando>https://github.com/lando/lando</a>. Along the way I found a post by the folks at <a href=https://colorfield.be/>colorfield</a>.</p>
<h2 id=following-colorfieldbe>Following colorfield.be</h2>
<p>See <a href=https://colorfield.be/blog/drupal-and-docker-the-easy-way-with-lando>Drupal and Docker the easy way with Lando</a>.</p>
<pre tabindex=0><code>╭─mark@Marks-Mac-Mini ~/GitHub
╰─$ php -d memory_limit=-1 composer.phar create-project drupal-composer/drupal-project:8.x-dev wieting-lando --stability dev --no-interaction
  ...wait for it...
  ╭─mark@Marks-Mac-Mini ~/GitHub
  ╰─$ cd wieting-lando
  ╭─mark@Marks-Mac-Mini ~/GitHub/wieting-lando
  ╰─$ lando init
  ? From where should we get your app's codebase? current working directory
  ? What recipe do you want to use? drupal8
  ? Where is your webroot relative to the init destination? web
  ? What do you want to call this app? wieting  

NOW WE'RE COOKING WITH FIRE!!!
Your app has been initialized!

Go to the directory where your app was initialized and run `lando start` to get rolling.
Check the LOCATION printed below if you are unsure where to go.

Oh... and here are some vitals:

 NAME      wieting
 LOCATION  /Users/mark/GitHub/wieting-lando
 RECIPE    drupal8
 DOCS      https://docs.devwithlando.io/tutorials/drupal8.html
</code></pre><p>Then&mldr;</p>
<pre tabindex=0><code>╭─mark@Marks-Mac-Mini ~/GitHub/wieting-lando
╰─$ atom .    # to add config: keys for via:nginx and database:mariadb
╭─mark@Marks-Mac-Mini ~/GitHub/wieting-lando
╰─$ lando start
Let's get this party started! Starting app..
Creating network &quot;landoproxyhyperion5000gandalfedition_edge&quot; with driver &quot;bridge&quot;
Creating landoproxyhyperion5000gandalfedition_proxy_1 ... done
Creating network &quot;wieting_default&quot; with the default driver
Creating wieting_database_1  ... done
Creating wieting_appserver_1 ... done
Creating wieting_appserver_nginx_1 ... done
Waiting until appserver_nginx service is ready...
Waiting until appserver service is ready...
Waiting until database service is ready...

BOOMSHAKALAKA!!!

Your app has started up correctly.
Here are some vitals:

 NAME                  wieting
 LOCATION              /Users/mark/GitHub/wieting-lando
 SERVICES              appserver_nginx, appserver, database
 APPSERVER_NGINX URLS  https://localhost:32808
                       http://localhost:32809
                       http://wieting.lndo.site
                       https://wieting.lndo.site
</code></pre><p>A visit to <a href=https://wieting.lndo.site>https://wieting.lndo.site</a> takes me to the <code>/core/install.php</code> script where I set the following&mldr;</p>
<ul>
<li>Language: English</li>
<li>Installation Profile: Standard</li>
<li>Database type: MariaDB</li>
<li>Database name: drupal8</li>
<li>Database username: drupal8</li>
<li>Database password: drupal8</li>
<li>Host: database</li>
</ul>
<p>BOOMSHAKALAKA! The site info was already there. The <a href=https://wieting.lndo.site>site</a> is up!</p>
<h2 id=composer-drush-and-drupal-console>Composer, Drush and Drupal Console</h2>
<p>Did some checking just to be sure these work&mldr;</p>
<pre tabindex=0><code>╭─mark@Marks-Mac-Mini ~/GitHub/wieting-lando
╰─$ lando composer --version
Composer 1.9.3 2020-02-04 12:58:49
╭─mark@Marks-Mac-Mini ~/GitHub/wieting-lando
╰─$ lando drush status
 Drupal version   : 8.8.2
 Site URI         : http://default
 DB driver        : mysql
 DB hostname      : database
 DB port          : 3306
 DB username      : drupal8
 DB name          : drupal8
 Database         : Connected
 Drupal bootstrap : Successful
 Default theme    : bartik
 Admin theme      : seven
 PHP binary       : /usr/local/bin/php
 PHP config       :
 PHP OS           : Linux
 Drush script     : /app/vendor/drush/drush/drush
 Drush version    : 10.2.1
 Drush temp       : /tmp
 Drush configs    : /app/vendor/drush/drush/drush.yml
                    /app/drush/drush.yml
 Install profile  : standard
 Drupal root      : /app/web
 Site path        : sites/default
 Files, Public    : sites/default/files
 Files, Temp      : /tmp
╭─mark@Marks-Mac-Mini ~/GitHub/wieting-lando
╰─$ lando drupal about

Drupal Console (1.9.4)
======================

Copy configuration files.
  drupal init

Download, install and serve Drupal 8
  drupal quick:start

Create a new Drupal project
  drupal site:new

Install a Drupal project
  drupal site:install

Lists all available commands
  drupal list

Update project to the latest version.
   drupal self-update

╭─mark@Marks-Mac-Mini ~/GitHub/wieting-lando
╰─$
</code></pre><p>Woot!</p>
<h2 id=committing-to-github>Committing to GitHub</h2>
<p>Since there are no secrets in this config, yet, I&rsquo;m going to push it to <em>GitHub</em>. Specifically&mldr; <a href=https://github.com/SummittDweller/wieting-lando>SummittDweller/wieting-lando</a>.</p>
<h2 id=restarting-local-development>Restarting Local Development</h2>
<p>I&rsquo;m back at work on the campus of <em>Grinnell College</em> today and am looking to pick up last evening&rsquo;s development here, so I need to &ldquo;move&rdquo; my project to a different host, namely <em>MA8660</em>. Let&rsquo;s see if this works&mldr;</p>
<pre tabindex=0><code>╭─markmcfate@ma8660 ~/GitHub ‹ruby-2.3.0›
╰─$ git clone https://github.com/SummittDweller/wieting-lando
Cloning into 'wieting-lando'...
remote: Enumerating objects: 30, done.
remote: Counting objects: 100% (30/30), done.
remote: Compressing objects: 100% (22/22), done.
remote: Total 30 (delta 0), reused 30 (delta 0), pack-reused 0
Unpacking objects: 100% (30/30), done.
╭─markmcfate@ma8660 ~/GitHub ‹ruby-2.3.0›
╰─$ cd wieting-lando           
</code></pre><p>Whoa! The <code>wieting-lando</code> directory looks a little empty, probably because I see that my <code>.gitignore</code> file ignored alot of stuff. 😦 No matter, let&rsquo;s see if we can work some magic&mldr;</p>
<pre tabindex=0><code>╭─markmcfate@ma8660 ~/GitHub/wieting-lando ‹ruby-2.3.0› ‹master›
╰─$ lando composer update
  ...and the magic happens...
╭─markmcfate@ma8660 ~/GitHub/wieting-lando ‹ruby-2.3.0› ‹master›
╰─$ lando start
Let's get this party started! Starting app..
  ...more magic...
Waiting until database service is ready...

BOOMSHAKALAKA!!!

Your app has started up correctly.
Here are some vitals:

 NAME                  wieting
 LOCATION              /Users/markmcfate/GitHub/wieting-lando
 SERVICES              appserver_nginx, appserver, database
 APPSERVER_NGINX URLS  https://localhost:32773
                       http://localhost:32774
                       http://wieting.lndo.site:8000
                       https://wieting.lndo.site:444
</code></pre><p>And BOOM, we are ready to install a new site again!</p>
<h2 id=switching-gearsagain>Switching Gears&mldr;Again</h2>
<p>I&rsquo;m turning my attention now to <code>summitt-dweller-DO-docker</code> and <a href=https://github.com/mogtofu33/docker-compose-drupal(https://github.com/mogtofu33/docker-compose-drupal)>https://github.com/mogtofu33/docker-compose-drupal(https://github.com/mogtofu33/docker-compose-drupal)</a> which I recently forked to <a href=https://github.com/SummittDweller/docker-compose-drupal>https://github.com/SummittDweller/docker-compose-drupal</a>.</p>
<p>My attempt to get my <code>wieting-lando</code> Drupal code up and working at <em>DigitalOcean</em> per the instructions in <a href=https://github.com/SummittDweller/docker-compose-drupal#installation-and-configuration>Installation and configuration</a> working as <code>administrator</code> on <code>summitt-dweller-DO-docker</code> looks like this:</p>
<pre tabindex=0><code>╭─administrator@summitt-dweller-DO-docker /opt
╰─$ git clone https://github.com/SummittDweller/docker-compose-drupal.git
╭─administrator@summitt-dweller-DO-docker /opt
╰─$ cd docker-compose-drupal
╭─administrator@summitt-dweller-DO-docker /opt/docker-compose-drupal ‹master›
╰─$ git checkout -b wieting
╭─administrator@summitt-dweller-DO-docker /opt/docker-compose-drupal ‹wieting›
╰─$ cp docker-compose.tpl.yml docker-compose.yml\ncp default.env .env
╭─administrator@summitt-dweller-DO-docker /opt/docker-compose-drupal ‹wieting›
╰─$ nano .env   # to make recommended edits
╭─administrator@summitt-dweller-DO-docker /opt/docker-compose-drupal ‹wieting›
╰─$ nano docker-compose.yml   # to make recommended edits
╭─administrator@summitt-dweller-DO-docker /opt/docker-compose-drupal ‹wieting›
╰─$ docker-compose config   # to check the config...good to go
</code></pre><p>Then from <code>MA8660</code>&mldr;</p>
<pre tabindex=0><code>╭─markmcfate@ma8660 ~/GitHub/wieting-lando ‹ruby-2.3.0› ‹master*›
╰─$ rsync -aruvi . administrator@104.248.237.235:/opt/docker-compose-drupal/drupal/. --progress
</code></pre><p>Then back on <code>summitt-dweller-DO-docker</code>&mldr;</p>
<pre tabindex=0><code>╭─administrator@summitt-dweller-DO-docker /opt/docker-compose-drupal ‹wieting›
╰─$ docker-compose up --build -d
</code></pre><p>But this command failed because of two issues:</p>
<ul>
<li><code>Cannot start service portainer: driver failed programming external connectivity on endpoint wieting-portainer</code> - <em>Portainer</em> is already running on this node, we don&rsquo;t need it again!</li>
<li><code>Cannot start service nginx: driver failed programming external connectivity on endpoint wieting-nginx</code> - Sure, port 80 is already occupied&mldr;we need some <em>Traefik</em> magic here!</li>
</ul>
<p>First step&mldr; remove (comment out) the <code>portainer</code> service in <code>docker-compose.yml</code>, and bring back the <code>dashboard</code> service just to see how it works.</p>
<p>Next step&mldr; add some <em>Traefik</em> labels and port assignments (see <code>summitt-dweller-DO-docker /opt/omeka-s2/docker-compose.yml</code> for examples) to our <code>docker-compose.yml</code> to aleviate the <code>nginx</code> port conflict issues.</p>
<h1 id=-do-as-he-says->^^^ Do As He Says ^^^</h1>
<p>And that&rsquo;s&mldr;promising. I&rsquo;ll be back. 😄</p>
</div>
<div class=post-footer>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//digital-library-applications-developer-blog.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</article>
</main>
</body>
</html>