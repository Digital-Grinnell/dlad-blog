<!doctype html><html lang=en-us><head><title>Pushing This Blog to Production // The Grinnell College Digital Library Application Developer's Blog</title><meta charset=utf-8><meta name=generator content="Hugo 0.96.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Mark A. McFate"><meta name=description content><link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.ec5c8abc0625bee34a87b8624d3c683035583f8314d537f8d266c9f01ad58d83.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Pushing This Blog to Production"><meta name=twitter:description content="Juan Treminio&rsquo;s blog post does a nice job of covering the steps necessary to engage Watchtower, GitHub, and an automated build configuration in Docker Hub. The entire process can be used to push your initial Hugo project to production, watch for changes in your GitHub project repo, compile the changes, build a new Docker image, and automatically push it to production. Like I said, it&rsquo;s an awesome workflow, and there&rsquo;s no need to repeat much of it here. However, I will provide some insight into issues we encountered, and the solutions we employed."><meta property="og:title" content="Pushing This Blog to Production"><meta property="og:description" content="Juan Treminio&rsquo;s blog post does a nice job of covering the steps necessary to engage Watchtower, GitHub, and an automated build configuration in Docker Hub. The entire process can be used to push your initial Hugo project to production, watch for changes in your GitHub project repo, compile the changes, build a new Docker image, and automatically push it to production. Like I said, it&rsquo;s an awesome workflow, and there&rsquo;s no need to repeat much of it here. However, I will provide some insight into issues we encountered, and the solutions we employed."><meta property="og:type" content="article"><meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/003-pushing-to-production/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-20T00:00:00+00:00"><meta property="article:modified_time" content="2018-11-20T00:00:00+00:00"></head><body><header class=app-header><a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a><h2>The Grinnell College Digital Library Application Developer's Blog</h2><div class=author-block><p class=site-rev>Compiled: Mar 29, 2022 at 1:35pm CDT<br>Content Updated: 2022-Mar-24 00:00 UTC</p><div class=name>by
<strong>Mark A. McFate</strong></div><div class=address>Grinnell College Libraries</div><div class=link><a href=mailto:></a></div><br></div><nav class=sidebar-nav><a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a></nav><p class=site-description>Mark's first Hugo site, a blog, formerly at Static.Grinnell.edu, moved to DigitalOcean, and now hosted on Azure.</p><div class=app-header-social><a target=_blank href=https://github.com/McFateM><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/gohugoio><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div><p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p></header><main class=app-container><div class=breadcrumbs><a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/003-pushing-to-production/>003 pushing to production</a></div><article class=post><header class=post-header><h1 class=post-title>Pushing This Blog to Production</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Nov 20, 2018
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong></div></header><div class=post-content><p><a href=https://jtreminio.com/blog/setting-up-a-static-site-with-hugo-and-push-to-deploy/>Juan Treminio&rsquo;s blog post</a> does a nice job of covering the steps necessary to engage <a href=https://github.com/v2tec/watchtower>Watchtower</a>, <a href=https://github.com/>GitHub</a>, and an automated build configuration in <a href=https://hub.docker.com/>Docker Hub</a>. The entire process can be used to push your initial <a href=https://gohugo.io/>Hugo</a> project to production, watch for changes in your GitHub project repo, compile the changes, build a new Docker image, and automatically push it to production. Like I said, it&rsquo;s an awesome workflow, and there&rsquo;s no need to repeat much of it here. However, I will provide some insight into issues we encountered, and the solutions we employed.</p><p>Please open <a href=https://jtreminio.com/blog/setting-up-a-static-site-with-hugo-and-push-to-deploy/>Juan&rsquo;s blog post</a> and focus on the section that begins like so:</p><div class=original><h2 id=docker-hub-automated-builds>Docker Hub Automated Builds</h2><p>After you have played around a bit with Hugo, commit any changes you have made
and push to a public repo on Github.</p></div><p>Work your way through the <code>Docker Hub Automated Builds</code> section, and if you run into problems return here and have a look at the last section of this post.</p><h2 id=troubleshooting---my-experience>Troubleshooting - My Experience</h2><p>I honestly had lots of problems creating an automated build of this blog&mldr;</p><p>I was also under a time-crunch to get this blog into production so I found a relatively simple way to do so without engaging automatic builds; I created a new Docker Hub repository and pushed the image created in Juan&rsquo;s <code>Manual deployment process steps</code> to that repository. I started by creating a new Docker Hub repository with the same name as my project, <code>blogs-McFateM</code>. <strong>An important note: Docker Hub will not accept uppercase letters in repository names, so as you can see above, I converted all uppercase to lowercase</strong>. The result of this step, for me, was an empty <a href=https://hub.docker.com/r/mcfatem/blogs-mcfatem/>https://hub.docker.com/r/mcfatem/blogs-mcfatem/</a>.</p><p>The remaining steps in my &lsquo;<em>emergency-push</em>&rsquo; process were all run from my local machine, with a terminal open to my project directory. The necessary commands were:</p><pre tabindex=0><code>docker login
docker tag hugo-test mcfatem/blogs-mcfatem:latest
docker push mcfatem/blogs-mcfatem:latest
</code></pre><p>A little explanation of the commands&mldr;</p><ul><li><p><code>docker login</code> - Requests your Docker Hub account credentials so that your terminal session can communicate with Docker Hub.</p></li><li><p><code>docker tag...</code> - Essentially renames your local image, the one created previously as <code>hugo-test</code>, to match your account and project name. In my case the account is <code>mcfatem</code>, my Docker Hub username, and the project is <code>blogs-McFateM</code>.</p></li><li><p><code>docker push...</code> - This command pushes the newly renamed image to your Docker Hub repository, and tags the image as <code>:latest</code>. This last part, the &lsquo;<em>latest</em>&rsquo; tag, is important because early on we set <em>Traefik</em> up on our production server to look for images tagged as &lsquo;<em>latest</em>&rsquo;. If you give your image a different tag, it won&rsquo;t work properly.</p></li></ul><p>If you&rsquo;ve successfully completed the automated build setup, or my &lsquo;<em>emergency-push</em>&rsquo; process, then the next step is to launch your project in production.</p><h2 id=launching-your-project>Launching Your Project</h2><p>You now have a working Docker image resting comfortably in Docker Hub. This final step will launch your project as a container on your production host. Juan&rsquo;s section covers this nicely. It begins like so:</p><div class=original><h2 id=starting-your-blog>Starting your blog</h2><p>Once the first build is finished on the Docker Hub we can create the initial
container for our blog on our server.</p><p>SSH into your server and run the following:</p><pre tabindex=0><code>NAME=jtreminio_com
HOST=jtreminio.com
IMAGE=&#34;jtreminio/jtreminio.com&#34;
docker container run -d --name ${NAME} \
    --label traefik.backend=${NAME} \
    --label traefik.docker.network=traefik_webgateway \
    --label traefik.frontend.rule=Host:${HOST} \
    --label traefik.port=80 \
    --label com.centurylinklabs.watchtower.enable=true \
    --network traefik_webgateway \
    --restart always \
    ${IMAGE}
</code></pre><p>Make sure to change <code>NAME</code>, <code>HOST</code> and <code>IMAGE</code> to your own information!</p></div><p>For this blog, I saved the applicable commands <a href=https://gist.github.com/McFateM/b40b3d03e25a552d95b17f175ce82a59>in this gist</a> where there is one notable change, in the <code>traefik.frontend.rule</code> label. Unlike Juan&rsquo;s command set, my label specifies both a <code>Host</code> and a <code>PathPrefixStrip</code> argument. The <code>PathPrefixStrip:/blogs/McFateM</code> tells <em>Traefik</em> to listen for a &lsquo;complete&rsquo; address with a path prefix, so <code>https://static.grinnell.edu/blogs/McFateM</code>. The rule sends all such requests to the <code>blogs-mcfatem</code> &lsquo;backend&rsquo; container, and strips the path prefix, <code>/blogs/McFateM</code>, off before doing so.</p><p>And that&rsquo;s a wrap. Until next time&mldr;</p></div><div class=post-footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//digital-library-applications-developer-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></main></body></html>