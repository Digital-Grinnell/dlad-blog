<!doctype html><html lang=en-us><head><title>Local ISLE Installation: Migrate Existing Islandora Site - One-Time Customizations // The Grinnell College Digital Library Application Developer's Blog</title><meta charset=utf-8><meta name=generator content="Hugo 0.105.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Mark A. McFate"><meta name=description content><link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.ec5c8abc0625bee34a87b8624d3c683035583f8314d537f8d266c9f01ad58d83.css><script type=text/javascript src=https://static.grinnell.edu/dlad-blog/js/pdf-js/build/pdf.js></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Local ISLE Installation: Migrate Existing Islandora Site - One-Time Customizations"><meta name=twitter:description content="This post is an addendum to earlier post 087. It is intended to chronicle my customization efforts, necessary steps that follow the aforementioned document&rsquo;s Step 11, to migrate to a local development instance of Digital.Grinnell on my work-issued iMac, MA8660, currently identified as MAD25W812UJ1G9. Please refer to Steps 0 - 11 in post 087 for background info.
Note that it should NOT be necessary to repeat steps taken in this document. Pertinent changes made herein were saved into a new completed-install-local-migrate branch of my dg-islandora project repository, effectively capturing all progress made within."><meta property="og:title" content="Local ISLE Installation: Migrate Existing Islandora Site - One-Time Customizations"><meta property="og:description" content="This post is an addendum to earlier post 087. It is intended to chronicle my customization efforts, necessary steps that follow the aforementioned document&rsquo;s Step 11, to migrate to a local development instance of Digital.Grinnell on my work-issued iMac, MA8660, currently identified as MAD25W812UJ1G9. Please refer to Steps 0 - 11 in post 087 for background info.
Note that it should NOT be necessary to repeat steps taken in this document. Pertinent changes made herein were saved into a new completed-install-local-migrate branch of my dg-islandora project repository, effectively capturing all progress made within."><meta property="og:type" content="article"><meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/090-isle-local-migration-customization/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-07T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-05T08:51:04-05:00"></head><body><header class=app-header><a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a><h2>The Grinnell College Digital Library Application Developer's Blog</h2><div class=author-block><p class=site-rev>Compiled: Nov 8, 2022 at 5:42pm CST<br>Content Updated: 2022-Nov-8 00:00 UTC</p><div class=name>by
<strong>Mark A. McFate</strong></div><div class=address>Grinnell College Libraries</div><div class=link><a href=mailto:></a></div><br></div><nav class=sidebar-nav><a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a></nav><p class=site-description>Mark's first Hugo site, a blog, formerly at Static.Grinnell.edu, moved to DigitalOcean, and now hosted on Azure.</p><div class=app-header-social><a target=_blank href=https://github.com/McFateM><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/gohugoio><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div><p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p></header><main class=app-container><div class=breadcrumbs><a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/090-isle-local-migration-customization/>090 isle local migration customization</a></div><article class=post><header class=post-header><h1 class=post-title>Local ISLE Installation: Migrate Existing Islandora Site - One-Time Customizations</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>17 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Sep 7, 2020
&nbsp;&nbsp;&bull;&nbsp;&nbsp;Updated: Oct 5, 2020 - 08:51
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/isle/>ISLE</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/migrate/>Migrate</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/local/>local</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/development/>development</a></div></div></header><div class=post-content><p>This post is an addendum to earlier <a href=https://static.grinnell.edu/dlad-blog/posts/087-rebuilding-isle-ld-again/>post 087</a>. It is intended to chronicle my <em>customization</em> efforts, necessary steps that follow the aforementioned document&rsquo;s <code>Step 11</code>, to migrate to a <code>local development</code> instance of <em>Digital.Grinnell</em> on my work-issued iMac, <code>MA8660</code>, currently identified as <code>MAD25W812UJ1G9</code>. Please refer to Steps 0 - 11 in <a href=https://static.grinnell.edu/dlad-blog/posts/087-rebuilding-isle-ld-again/>post 087</a> for background info.</p><div class=original><p>Note that it <strong>should NOT be necessary to repeat steps taken in this document</strong>. Pertinent changes made herein were saved into a new <code>completed-install-local-migrate</code> branch of my <a href=https://github.com/Digital-Grinnell/dg-islandora/>dg-islandora</a> project repository, effectively capturing all progress made within.</p></div><h2 id=goal>Goal</h2><p>The goal of this project is once again to spin up a local Islandora stack using <a href=https://github.com/Islandora-Collaboration-Group/ISLE/>the ISLE project</a> following the guidance of the project&rsquo;s <a href=https://github.com/Islandora-Collaboration-Group/ISLE/blob/master/docs/install/install-local-migrate.md>install-local-migrate</a> document. My process will be slightly different than documented since I&rsquo;ve already created a pair of private <a href=https://github.com/Digital-Grinnell/dg-isle/>dg-isle</a> and <a href=https://github.com/Digital-Grinnell/dg-islandora/>dg-islandora</a> repositories.</p><div class=annotation><p>Note that there are no formal &ldquo;annotations&rdquo; in this document because everything here is an addendum/annotation to the original <a href=https://github.com/Islandora-Collaboration-Group/ISLE/blob/master/docs/install/install-local-migrate.md>install-local-migrate</a> document.</p></div><h2 id=outcomes-of-step-11>Outcomes of Step 11</h2><p>As part of <a href=https://static.grinnell.edu/dlad-blog/posts/087-rebuilding-isle-ld-again#step-11-test-the-site>Step 11</a> I visited <a href=https://dg.localdomain>https://dg.localdomain</a> on my iMac desktop and found that the site came up looking and behaving just as it should, but with two warnings. The complete list of warnings was:</p><pre tabindex=0><code>    User warning: The following module is missing from the file system: antibot. For information about how to fix this, see the documentation page. in _drupal_trigger_error_with_delayed_logging() (line 1156 of /var/www/html/includes/bootstrap.inc).
    User warning: The following module is missing from the file system: islandora_mods_via_twig. For information about how to fix this, see the documentation page. in _drupal_trigger_error_with_delayed_logging() (line 1156 of /var/www/html/includes/bootstrap.inc).
</code></pre><h2 id=dealing-with-warnings>Dealing with Warnings</h2><p>Resolving these warnings would basically involve adding the missing modules to my <em>dg-islandora</em> repository. Remember, in our <code>docker-compose.local.yml</code> file we map the following:</p><pre tabindex=0><code>volumes:
  # Customization: Bind mounting Drupal Code instead of using default Docker volumes for local development with an IDE.
  - ../dg-islandora:/var/www/html:cached
</code></pre><p>So the task before me was to add these things to <em>dg-islandora</em>, and save the changes into the <em>dg-islandora</em> repo for use later on. Looking at my production instance of ISLE on <em>DGDocker1</em>, I found that the only missing &ldquo;contrib&rdquo; module was <code>antibot</code> which currently resides in <code>/opt/ISLE/persistent/html/sites/all/modules/contrib/antibot</code>. The other missing module was part of the &ldquo;islandora&rdquo; branch of the module tree, residing in subdirectories of <code>/opt/ISLE/persistent/html/sites/all/modules/islandora/islandora_mods_via_twig</code>.</p><h3 id=antibot>antibot</h3><p>The <a href=https://www.drupal.org/project/antibot>antibot</a> module currently resides in <code>/opt/ISLE/persistent/html/sites/all/modules/contrib/antibot</code> on <em>DGDocker1</em>. I was curious what would happen if I opened a terminal into my local <em>Apache</em> container and used <code>drush pm-download...</code> to try installing this module. My command sequence on my desktop workstation was this:</p><table><thead><tr><th>Workstation Commands</th></tr></thead><tbody><tr><td>docker exec -w /var/www/html/sites/default isle-apache-ld drush pm-download antibot<br>docker exec -w /var/www/html/sites/default isle-apache-ld drush cc all</td></tr></tbody></table><p>The results were very promising as the first command returned this:</p><pre tabindex=0><code>Project antibot (7.x-1.2) downloaded to                                [success]
/var/www/html/sites/all/modules/contrib/antibot.
</code></pre><p>The 2nd <code>drush...</code> command subsequently returned only one warning <strong>since the <code>antibot</code> warning was gone</strong>! A peek inside my <code>dg-islandora</code> instance on the workstation was also promising. There I found this:</p><pre tabindex=0><code>╭─markmcfate@MAD25W812UJ1G9 ~/GitHub/dg-islandora/sites/all/modules/contrib ‹ruby-2.3.0› ‹master*›
╰─$ ll
total 0
drwxr-x---@ 21 markmcfate  staff   672B Sep  1 15:31 admin_menu
drwxr-x---@  9 markmcfate  staff   288B Sep  1 15:31 admin_theme
drwxr-x---@ 12 markmcfate  staff   384B Sep  1 15:31 announcements
drwxr-xr-x  11 markmcfate  staff   352B Jun 10  2018 antibot
drwxr-x---@ 12 markmcfate  staff   384B Sep  1 15:31 backup_migrate
...
</code></pre><p>So it appears that <code>antibot</code> was properly downloaded to the correct owner/group, and all that&rsquo;s missing is a proper set of its permissions, although I suspect it will function properly just as it is. A peek inside the new <code>antibot</code> directory showed this:</p><pre tabindex=0><code>╭─markmcfate@MAD25W812UJ1G9 ~/GitHub/dg-islandora/sites/all/modules/contrib/antibot ‹ruby-2.3.0› ‹master*›
╰─$ ll
total 96
-rw-r--r--  1 markmcfate  staff    18K Nov 16  2016 LICENSE.txt
-rw-r--r--  1 markmcfate  staff    91B Jun  6  2018 README.txt
-rw-r--r--  1 markmcfate  staff   1.2K Jun  6  2018 antibot.admin.inc
-rw-r--r--  1 markmcfate  staff   286B Jun 10  2018 antibot.info
-rw-r--r--  1 markmcfate  staff   224B Jun  6  2018 antibot.install
-rw-r--r--  1 markmcfate  staff   5.2K Jun  6  2018 antibot.module
-rw-r--r--  1 markmcfate  staff   765B Jun  6  2018 antibot.pages.inc
drwxr-xr-x  3 markmcfate  staff    96B Jun  6  2018 js
drwxr-xr-x  3 markmcfate  staff    96B Jun  6  2018 templates
</code></pre><p>A check of the equivalent directories and files on <em>DGDocker1</em> revealed much the same as you can see in the abridged output below.</p><pre tabindex=0><code>[islandora@dgdocker1 contrib]$ ll
total 268
drwxr-x---.  2 islandora 33 4096 Nov 19  2014 addanother
drwxr-x---.  3 islandora 33 4096 Dec  6  2010 admin_theme
drwxr-x---.  5 islandora 33 4096 Apr 14  2018 advanced_help
drwxr-x---.  2 islandora 33 4096 Jan 20  2015 announcements
drwxr-xr-x.  4 islandora 33 4096 Jun 10  2018 antibot
drwxr-x---.  4 islandora 33 4096 Dec 15  2018 backup_migrate
...
[islandora@dgdocker1 contrib]$ cd antibot
[islandora@dgdocker1 antibot]$ ll
total 48
-rw-r--r--. 1 islandora 33  1196 Jun  7  2018 antibot.admin.inc
-rw-r--r--. 1 islandora 33   286 Jun 10  2018 antibot.info
-rw-r--r--. 1 islandora 33   224 Jun  7  2018 antibot.install
-rw-r--r--. 1 islandora 33  5370 Jun  7  2018 antibot.module
-rw-r--r--. 1 islandora 33   765 Jun  7  2018 antibot.pages.inc
drwxr-xr-x. 2 islandora 33    23 Jun  7  2018 js
-rw-r--r--. 1 islandora 33 18092 Nov 16  2016 LICENSE.txt
-rw-r--r--. 1 islandora 33    91 Jun  7  2018 README.txt
drwxr-xr-x. 2 islandora 33    34 Jun  7  2018 templates
</code></pre><p>I subsequently logged in to both my production and local instances of ISLE and visited the corresponding <code>antibot</code> configuration pages at <a href=https://digital.grinnell.edu/admin/config/system/antibot>https://digital.grinnell.edu/admin/config/system/antibot</a> and <a href="https://dg.localdomain/islandora/object/islandora%3Aroot#overlay=admin/config/system/antibot">https://dg.localdomain/islandora/object/islandora%3Aroot#overlay=admin/config/system/antibot</a>. The nearly identical pages indicate that my <code>antibot</code> configruation, presumably part of my imported production <em>Drupal</em> database, is intact and exactly as it should be. This was good news indeed!</p><h3 id=islandora_mods_via_twig>islandora_mods_via_twig</h3><p>On <em>DGDocker1</em> I found a <code>.git</code> subdirectory in the <code>/opt/ISLE/persistent/html/sites/all/modules/islandora/islandora_mods_via_twig</code> directory indicating that this module should be provisioned using <code>git</code>. The module has a <code>git remote -v</code> response of <code>origin https://github.com/DigitalGrinnell/islandora_mods_via_twig.git</code> so I believe it would be prudent to add it as another git submodule. I did that like so:</p><table><thead><tr><th>Workstation Commands</th></tr></thead><tbody><tr><td><code>cd ~/GitHub/dg-islandora</code><br><code>git submodule add https://github.com/DigitalGrinnell/islandora_mods_via_twig.git sites/all/modules/islandora/islandora_mods_via_twig</code><br><code>docker exec -w /var/www/html/sites/default isle-apache-ld drush cc all</code></td></tr></tbody></table><p>A quick visit to <a href=https://dg.localdomain>https://dg.localdomain</a> on my local workstation shows the site is working and with <strong>no visible errors or warnings</strong>! Woot!</p><h3 id=two-probable-issues>Two Probable Issues</h3><p>So, it works&mldr;maybe. However, I am concerned with a couple of things so I decided to take a peek inside my new local ISLE instance to check. I did indeed find a couple of problems.</p><h4 id=permissions-and-ownership-of-antibot-and-islandora_mods_via_twig>Permissions and Ownership of &ldquo;antibot&rdquo; and &ldquo;islandora_mods_via_twig&rdquo;</h4><p>Inside the <em>Apache</em> container I checked the permissions of my <code>/var/www/html/sites/all/modules/islandora</code> directory and found this, abridged for clarity:</p><pre tabindex=0><code>drwxr-x--- 10 islandora www-data  320 Sep  9 22:21 islandora_mods_display/
drwxr-xr-x  8 www-data  www-data  256 Sep 10 03:08 islandora_mods_via_twig/
drwxr-x--- 20 islandora www-data  640 Sep 10 02:10 islandora_multi_importer/
</code></pre><p>Likewise, inside <code>/var/www/html/sites/all/modules/contrib</code> I found this, also abridged for clarity:</p><pre tabindex=0><code>drwxr-x--- 12 islandora www-data  384 Sep  9 22:20 announcements/
drwxr-xr-x 11 www-data  www-data  352 Jun 11  2018 antibot/
drwxr-x--- 12 islandora www-data  384 Sep  9 22:20 backup_migrate/
</code></pre><p>And inside both of those subdirectories I found structures with owner/group and permissions like this:</p><pre tabindex=0><code>root@5686019d1a3a:/var/www/html/sites/all/modules/islandora/islandora_mods_via_twig# ll
total 88
drwxr-xr-x  8 root      root       256 Sep 10 03:08 ./
drwxr-x--- 63 islandora www-data  2016 Sep 10 03:08 ../
-rw-r--r--  1 root      root        88 Sep 10 03:08 .git
-rwxr-xr-x  1 root      root     16683 Sep 10 03:08 islandora_mods_via_twig.drush.inc*
-rw-r--r--  1 root      root       265 Sep 10 03:08 islandora_mods_via_twig.info
-rw-r--r--  1 www-data  www-data    67 Sep 10 03:08 islandora_mods_via_twig.module
-rw-r--r--  1 root      root     35064 Sep 10 03:08 LICENSE.txt
-rw-r--r--  1 root      root     17925 Sep 10 03:08 README.md
</code></pre><p>Not good from an owner/group perspective, but looking OK in terms of permissions? So, the necessary changes I need to make here are ones that were previously performed as part of the <code>migration_site_vsets.sh</code> script back in <a href=https://static.grinnell.edu/dlad-blog/posts/087-rebuilding-isle-ld-again#step-10-run-islandora-drupal-site-scripts>Step 10: Run Islandora Drupal Site Scripts</a>. Specifically, inside the <em>Apache</em> container I need to rerun this command from that script:</p><table><thead><tr><th><em>isle-apache-ld</em> Container Commands</th></tr></thead><tbody><tr><td><code>/bin/bash /utility-scripts/isle_drupal_build_tools/drupal/fix-permissions.sh --drupal_path=/var/www/html --drupal_user=islandora --httpd_group=www-data</code></td></tr></tbody></table><p>A quick check of the aforementioned directories and files inside the <em>Apache</em> container shows that owner/group and permissions are now as-they-should-be. Yay!</p><h4 id=where-have-all-the-files-gone>Where Have All the Files Gone?</h4><p>Ok, so I&rsquo;m showing my age with that subtitle, I know. But it&rsquo;s a valid question, perhaps best summed up in this <em>Slack</em> post of mine:</p><div class=original><p>At <a href=https://github.com/Islandora-Collaboration-Group/ISLE/blob/master/docs/install/install-local-migrate.md#drupal-site-files-and-code>https://github.com/Islandora-Collaboration-Group/ISLE/blob/master/docs/install/install-local-migrate.md#drupal-site-files-and-code</a> I made a copy of my production <code>/var/www/html/sites/default/files</code> directory anticipating that &ldquo;You&rsquo;ll move this directory in later steps.&rdquo; I must have missed something, because I can&rsquo;t find anyplace in the document where I moved those files into my new local instance of ISLE.</p></div><p>The resolution of this issue is now covered in the annotation at the end of <a href=https://static.grinnell.edu/dlad-blog/posts/087-rebuilding-isle-ld-again#step-9-import-the-production-mysql-drupal-database>Step 9: Import the Production MySQL Drupal Database</a>.</p><h2 id=next-steps>Next Steps</h2><p>After completion of everything mentioned in this document, I returned to <a href=https://static.grinnell.edu/dlad-blog/posts/087-rebuilding-isle-ld-again#step-12-ingest-sample-objects>Step 12: Ingest Sample Objects</a> but ended my work there differently than suggested. The differences are all covered in one final annotation there.</p><p>The <code>install-local-migrate.md</code> document subsequently suggests moving on to <a href=https://static.grinnell.edu/dlad-blog/posts/install/install-staging-migrate.md>Staging ISLE Installation: Migrate Existing Islandora Site</a> and I believe I will do just that, probably with production of another annotated document to chronicle my specific experience.</p><p>But before I go&mldr; I elected to take two more steps here. The first is&mldr;</p><ul><li>Updating my <code>dg-islandora</code> repository with all of the changes made thus far.<ul><li>Note that I did indeed update <code>dg-islandora</code>, but not the <code>master</code> branch. In my workstation&rsquo;s <code>~/GitHub/dg-islandora</code> directory I did this in order to save all changes made thus far into a new <code>completed-install-local-migrate</code> branch for safe-keeping.</li></ul></li></ul><pre tabindex=0><code>  ╭─markmcfate@MAD25W812UJ1G9 ~/GitHub/dg-islandora ‹ruby-2.3.0› ‹master*›
  ╰─$ git status
  On branch master
  Your branch is up to date with &#39;origin/master&#39;.

  Changes to be committed:
    (use &#34;git reset HEAD &lt;file&gt;...&#34; to unstage)

  	modified:   .gitmodules
  	new file:   html/sites/all/modules/islandora/islandora_mods_via_twig
  	new file:   sites/all/modules/islandora/islandora_mods_via_twig

  Changes not staged for commit:
    (use &#34;git add/rm &lt;file&gt;...&#34; to update what will be committed)
    (use &#34;git checkout -- &lt;file&gt;...&#34; to discard changes in working directory)
    (commit or discard the untracked or modified content in submodules)

  	modified:   .gitignore
  	modified:   .gitmodules
  	deleted:    html/sites/all/modules/islandora/islandora_mods_via_twig
  	modified:   install_solution_packs.sh
  	modified:   migration_site_vsets.sh
  	modified:   sites/all/modules/islandora/dg7 (modified content)
  	modified:   sites/all/modules/islandora/islandora_mods_display (modified content)
  	modified:   sites/all/modules/islandora/islandora_mods_via_twig (modified content)
  	modified:   sites/all/modules/islandora/islandora_multi_importer (modified content)
  	modified:   sites/all/modules/islandora/islandora_scholar/modules/citeproc/composer.lock
  	modified:   sites/all/modules/islandora/islandora_solution_pack_oralhistories (modified content)

  Untracked files:
    (use &#34;git add &lt;file&gt;...&#34; to include in what will be committed)

  	sites/all/modules/contrib/antibot/

  ╭─markmcfate@MAD25W812UJ1G9 ~/GitHub/dg-islandora ‹ruby-2.3.0› ‹master*›
  ╰─$ git checkout -b completed-install-local-migrate
    M	.gitignore
    M	.gitmodules
    M	install_solution_packs.sh
    M	migration_site_vsets.sh
    M	sites/all/modules/islandora/dg7
    M	sites/all/modules/islandora/islandora_mods_display
    A	sites/all/modules/islandora/islandora_mods_via_twig
    M	sites/all/modules/islandora/islandora_multi_importer
    M	sites/all/modules/islandora/islandora_scholar/modules/citeproc/composer.lock
    M	sites/all/modules/islandora/islandora_solution_pack_oralhistories
    Switched to a new branch &#39;completed-install-local-migrate&#39;
</code></pre><p>I considered trying to update <em>Drupal</em> and its contrib modules from the web interface at <a href="https://dg.localdomain/#overlay=admin/modules/update">https://dg.localdomain/#overlay=admin/modules/update</a> but doing so requires FTP acccess which my local instance does not have. So, I considered using <code>drush up</code> instead, and it appears to be working properly. So, in my workstation I got this:</p><pre tabindex=0><code>╭─markmcfate@MAD25W812UJ1G9 ~/GitHub/dg-isle ‹ruby-2.3.0› ‹master*›
╰─$ docker exec -it isle-apache-ld bash
root@e34ab55f94aa:/# cd /var/www/html/sites/default/
root@e34ab55f94aa:/var/www/html/sites/default# drush up
Update information last refreshed: Thu, 2020-09-10 15:57
 Name                                           Installed Version  Proposed version  Message
 Drupal                                         7.67               7.72              SECURITY UPDATE available
 Views Bulk Operations (views_bulk_operations)  7.x-3.5            7.x-3.6           Update available
 Backup and Migrate (backup_migrate)            7.x-3.6            7.x-3.9           Update available
 Colorbox (colorbox)                            7.x-2.13           7.x-2.15          Update available
 Git Deploy (git_deploy)                        7.x-1.x-dev        7.x-1.3           Update available
 Maillog / Mail Developer (maillog)             7.x-1.0-alpha1     7.x-1.0-rc1       Update available
 Views (views)                                  7.x-3.23           7.x-3.24          Update available
 Webform (webform)                              7.x-4.20           7.x-4.23          SECURITY UPDATE available


NOTE: A security update for the Drupal core is available.
Drupal core will be updated after all of the non-core projects are updated.

Security and code updates will be made to the following projects: Views Bulk Operations (VBO) [views_bulk_operations-7.x-3.6], Backup and Migrate [backup_migrate-7.x-3.9], Colorbox [colorbox-7.x-2.15], Git Deploy [git_deploy-7.x-1.3], Maillog / Mail Developer [maillog-7.x-1.0-rc1], Views (for Drupal 7) [views-7.x-3.24], Webform [webform-7.x-4.23]

Note: A backup of your project will be stored to backups directory if it is not managed by a supported version control system.
Note: If you have made any modifications to any file that belongs to one of these projects, you will have to migrate those modifications after updating.
Do you really want to continue with the update process? (y/n): y
Project views_bulk_operations was updated successfully. Installed version is now 7.x-3.6.
Backups were saved into the directory                                                                              [ok]
/root/drush-backups/digital_grinnell/20200910205644/modules/views_bulk_operations.
Project backup_migrate was updated successfully. Installed version is now 7.x-3.9.
Backups were saved into the directory /root/drush-backups/digital_grinnell/20200910205644/modules/backup_migrate.  [ok]
Project colorbox was updated successfully. Installed version is now 7.x-2.15.
Backups were saved into the directory /root/drush-backups/digital_grinnell/20200910205644/modules/colorbox.        [ok]
Project git_deploy was updated successfully. Installed version is now 7.x-1.3.
Backups were saved into the directory /root/drush-backups/digital_grinnell/20200910205644/modules/git_deploy.      [ok]
Project maillog was updated successfully. Installed version is now 7.x-1.0-rc1.
Backups were saved into the directory /root/drush-backups/digital_grinnell/20200910205644/modules/maillog.         [ok]
Project views was updated successfully. Installed version is now 7.x-3.24.
Backups were saved into the directory /root/drush-backups/digital_grinnell/20200910205644/modules/views.           [ok]
Project webform was updated successfully. Installed version is now 7.x-4.23.
Backups were saved into the directory /root/drush-backups/digital_grinnell/20200910205644/modules/webform.         [ok]

Code updates will be made to drupal core.
WARNING:  Updating core will discard any modifications made to Drupal core files, most noteworthy among these are .htaccess and robots.txt.  If you have made any modifications to these files, please back them up before updating so that you can re-create your modifications in the updated version of the file.
Note: Updating core can potentially break your site. It is NOT recommended to update production sites without prior testing.

Do you really want to continue? (y/n): y
Project drupal was updated successfully. Installed version is now 7.72.
Backups were saved into the directory /root/drush-backups/digital_grinnell/20200910205644/drupal.                  [ok]
require_once(/lib/glip.php): failed to open stream: No such file or directory git_deploy.module:46                 [warning]
PHP Fatal error:  require_once(): Failed opening required &#39;/lib/glip.php&#39; (include_path=&#39;.:/usr/share/php&#39;) in /var/www/html/sites/all/modules/contrib/git_deploy/git_deploy.module on line 46
Drush command terminated abnormally due to an unrecoverable error.                                                 [error]
Error: require_once(): Failed opening required &#39;/lib/glip.php&#39; (include_path=&#39;.:/usr/share/php&#39;) in
/var/www/html/sites/all/modules/contrib/git_deploy/git_deploy.module, line 46
The external command could not be executed due to an application error.
</code></pre><p>So, it looks like modules and core were updated successfully? I&rsquo;m just not sure what the impact of the warning and <code>PHP Fatal error</code> might be. 😦</p><p>A little investigation suggests that we are missing the <a href=github.com/halstead/glip.git>glip library</a>, so following the guidance in <a href=~/GitHub/dg-islandora/sites/all/modules/contrib/git_deploy/README.txt>the <code>git_deploy</code> module&rsquo;s <code>README.txt</code></a> I did this from my workstation:</p><pre tabindex=0><code>╭─markmcfate@MAD25W812UJ1G9 ~/GitHub/dg-islandora/sites/all/libraries ‹ruby-2.3.0› ‹completed-install-local-migrate*›
╰─$ git clone git://github.com/halstead/glip.git
   cd glip
   git checkout 1.1
Cloning into &#39;glip&#39;...
remote: Enumerating objects: 319, done.
remote: Total 319 (delta 0), reused 0 (delta 0), pack-reused 319
Receiving objects: 100% (319/319), 101.97 KiB | 593.00 KiB/s, done.
Resolving deltas: 100% (163/163), done.
Note: checking out &#39;1.1&#39;.

You are in &#39;detached HEAD&#39; state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b &lt;new-branch-name&gt;

HEAD is now at 79f5472... Implement support for alternates object stores.
</code></pre><p>Then, taking another shot at <code>drush up</code> from my <em>Apache</em> container:</p><pre tabindex=0><code>╭─markmcfate@MAD25W812UJ1G9 ~/GitHub/dg-isle ‹ruby-2.3.0› ‹master*›
╰─$ docker exec -it isle-apache-ld bash
root@e34ab55f94aa:/# cd /var/www/html/sites/default/
root@e34ab55f94aa:/var/www/html/sites/default# drush up
Error while trying to find the common path for enabled extensions of project dg-islandora. Extensions are:         [error]
announcements, islandora_altmetrics, islandora_badges, islandora_example_simple_text, islandora_image_annotation,
islandora_oadoi, islandora_scopus, islandora_sync, islandora_sync_field_collection, islandora_sync_relation,
islandora_webform_ingest, islandora_wos, webform_bonus, webform_digest.
Update information last refreshed: Thu, 2020-09-10 15:57
 Name                   Installed Version  Proposed version  Message
 Bootstrap (bootstrap)  7.x-3.21           7.x-3.26          SECURITY UPDATE available


Security updates will be made to the following projects: Bootstrap [bootstrap-7.x-3.26]

Note: A backup of your project will be stored to backups directory if it is not managed by a supported version control system.
Note: If you have made any modifications to any file that belongs to one of these projects, you will have to migrate those modifications after updating.
Do you really want to continue with the update process? (y/n): y
Project bootstrap was updated successfully. Installed version is now 7.x-3.26.
Backups were saved into the directory /root/drush-backups/digital_grinnell/20200910213813/themes/bootstrap.        [ok]
 System             7083  Add &#39;jquery-html-prefilter-3.5.0-backport.js&#39; to the &#39;jquery&#39; library.
 System             7084  Rebuild JavaScript aggregates to include &#39;ajax.js&#39; fix for Chrome 83.
 Backup_migrate     7308  Update profiles table filter field to accommodate larger serialized strings.
 Backup_migrate     7309  NodeSquirrel support has been removed.
 Backup_migrate     7310  Disable e-mail destinations.
 Backup_migrate     7311  Adjust the default performance settings.
 Git_deploy         7000  Save current location of glip library.
 Maillog            7100  Rename the &#39;idmaillog&#39; field to just &#39;id&#39;.
 Maillog            7101  Clear the menu cache so the new paths will be picked up.
 Maillog            7102  Clear the Views cache so the updated admin page will get the new paths.
 Islandora          7002  Implements hook_update_N().   Removing old variable around changes to ingestDatastream signature.
                          These changes are complete and deprecation warnings are removed.
 Islandora_oai      7103  Add support for QDC.
 Islandora_scholar  7103  Maintain existing RGB colorspace profile configuration.
 Islandora_scholar  7104  Disable Islandora Google Scholar if it is currently enabled, since logic now lives in Islandora
                          Scholar
 Citeproc           7101  Set citeproc version if you are updating.    That way the library used doesn&#39;t switch under your
                          feet, when updating to   the latest version.
 Islandora_entitie  7100  Add the default description field to the Scholar solr metadata profile.
 s
 Islandora_entitie  7200  Print and log a message about potential lost Position data.   @see
 s                        https:jira.duraspace.orgbrowseISLANDORA-2137
 Islandora_pdf      7001  Maintain existing RGB colorspace profile configuration.
 Islandora_pdf      7100  Set and maintain new dUseCIEColor switch variable.
 Islandora_video    7101  Implements hook_update_N().   Deletes the unused legacy variable islandora_video_retain_original.
 Islandora_webform  7001  Add webform_workflow state permissions schema to webform table.
 Islandora_webform  7002  Add draft_access field to webform table.
 Xml_form_builder   7105  Make title_field not required.   Repeating because hook_schema wasn&#39;t updated.
 Xml_form_builder   7106  Update fields to have not NULL.   Had a syntax error in our schema.
 Xml_form_builder   7107  Allow null in tranform field.   Previous update was causing issues when the transform was allowed
                          to be null.
 Xml_form_elements  7001  Rename the datepicker element as it collides with another element.
Do you wish to run all pending updates? (y/n): y
Performed update: backup_migrate_update_7308                                                                       [ok]
Performed update: backup_migrate_update_7309                                                                       [ok]
Performed update: maillog_update_7100                                                                              [ok]
Performed update: xml_form_builder_update_7105                                                                     [ok]
Performed update: system_update_7083                                                                               [ok]
Set colorspace configuration to RBG to maintain existing profile.                                                  [ok]
Performed update: islandora_pdf_update_7001                                                                        [ok]
No destinations were affected by this change.                                                                      [ok]
Performed update: backup_migrate_update_7310                                                                       [ok]
Performed update: xml_form_builder_update_7106                                                                     [ok]
Performed update: maillog_update_7101                                                                              [ok]
Performed update: islandora_webform_update_7001                                                                    [ok]
Set colorspace configuration to RBG to maintain existing profile.                                                  [ok]
Performed update: islandora_scholar_update_7103                                                                    [ok]
Performed update: islandora_entities_update_7100                                                                   [ok]
Performed update: xml_form_builder_update_7107                                                                     [ok]
Performed update: islandora_webform_update_7002                                                                    [ok]
Performed update: islandora_video_update_7101                                                                      [ok]
Performed update: islandora_pdf_update_7100                                                                        [ok]
Illegal offset type in isset or empty module.inc:280                                                               [warning]
The Islandora Google Scholar submodule has been removed, and its functionality has been moved into the main        [ok]
Islandora Scholar module.
Performed update: islandora_scholar_update_7104                                                                    [ok]
The original default form used two-word labels in the Position element, but removed spaces in the MADS XML.  This  [ok]
has been fixed as of 7.x-1.13. When editing existing objects with the new form, older values under Position will
not be read and will be discarded.  Please consult the &lt;a
href=&#34;https://jira.duraspace.org/browse/ISLANDORA-2137&#34;&gt;ticket&lt;/a&gt; for further information.
Performed update: islandora_entities_update_7200                                                                   [ok]
Performed update: citeproc_update_7101                                                                             [ok]
Performed update: system_update_7084                                                                               [ok]
Performed update: islandora_oai_update_7103                                                                        [ok]
Performed update: islandora_update_7002                                                                            [ok]
Performed update: maillog_update_7102                                                                              [ok]
Performed update: git_deploy_update_7000                                                                           [ok]
Performed update: backup_migrate_update_7311                                                                       [ok]
Performed update: xml_form_elements_update_7001                                                                    [ok]
Parsing DG One Form to Rule Them All for datepicker elements.                                                      [ok]
NodeSquirrel stopped being usable as a backup destination on October 1st, 2019 and ceased operations entirely on   [status]
November 1st, 2019. Because of this, the NodeSquirrel functionality has been disabled. Please switch to an
alternate destination if necessary. Please note that the NodeSquirrel configuration itself has not been removed.
Skipped DG One Form to Rule Them All (201) as no occurrences were found.                                           [status]
&#39;all&#39; cache was cleared.                                                                                           [success]
Finished performing updates.                                                                                       [ok]
</code></pre><p>In spite of the one error, this is looking much better. However, a quick visit to the <a href=https://dg.localdomain>local site</a> returns a page with LOTS of Javascript errors and so the image tiles that appear on our home page are no longer constrained to any reasonable size. 😦 Most errors are of the form:</p><pre tabindex=0><code>Blocked loading mixed active content &#34;http://dg.localdomain/sites/default/files/css/css_lQaZfjVpwP_oGNqdtWCSpJT1EMqXdMiU84ekLLxQnc4.css&#34;
</code></pre><p>This was not my first rodeo, so I immediately took a look at file permissions and ownership in the <em>Apache</em> container&rsquo;s <code>/var/www/html</code> directory, and it&rsquo;s a mess. Time to run the <code>fix-permissions.sh</code> script again&mldr;</p><table><thead><tr><th><em>isle-apache-ld</em> Container Commands</th></tr></thead><tbody><tr><td><code>/bin/bash /utility-scripts/isle_drupal_build_tools/drupal/fix-permissions.sh --drupal_path=/var/www/html --drupal_user=islandora --httpd_group=www-data</code></td></tr></tbody></table><p>And that helped a great deal, but didn&rsquo;t quite bring the site back exactly as it should have been. Upon detailed examination of the aforementioned error, I recognized an old enemy, a &ldquo;mixed mode&rdquo; browser warning. But I could not recall how I&rsquo;ve fixed this in the past, so I turned to <a href=https://icg-chat.slack.com/archives/CG6HZRWQM>the ICG&rsquo;s #isle-support Slack channel</a> where my hero, <a href=https://www.linkedin.com/in/noahwsmith/>Noah Smith</a>, from <a href=https://born-digital.com/>Born-Digital</a> immediately came to my rescue, again!</p><h3 id=the-mixed-mode-fix>The Mixed Mode Fix</h3><p>Noah suggested that they routinely run this script to fix &ldquo;mixed mode&rdquo; errors.</p><pre tabindex=0><code>grep -ri &#39;SetEnvIf X-Forwarded-Proto https HTTPS=on&#39; web/.htaccess || echo \&#34;SetEnvIf X-Forwarded-Proto https HTTPS=on\&#34; | tee -a web/.htaccess
</code></pre><h2 id=next-steps-not-yet-taken>Next Steps NOT Yet Taken</h2><p>It&rsquo;s worth noting here that other things I considered doing next, but did not, include:</p><ul><li>Updating all of the <em>Drupal</em> contrib and <em>Islandora</em> modules &ndash; this should have gotten done for the contrib modules and <em>Drupal</em> core, but I&rsquo;m not sure how to best approach this for all of the Islandora modules, so I chose not to do this yet. So, I&rsquo;m planning to wait and complete this step from my <code>staging</code> instance of ISLE.</li><li>Install and configure <a href=https://github.com/Islandora-Collaboration-Group/LASIR>LASIR</a> &ndash; this will also be delayed until after my migration instance is up-to-date and in production.</li><li>Configure and engage &ldquo;new&rdquo; ISLE features like &ldquo;Automated Testing&rdquo; &ndash; this will also be delayed until after my migration instance is up-to-date and in production.</li></ul><p>And that&rsquo;s a wrap. Until next time&mldr;</p></div><div class=post-footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//digital-library-applications-developer-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></main></body></html>