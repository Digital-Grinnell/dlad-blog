<!doctype html><html lang=en-us><head><title>Updating Digital.Grinnell in ISLE // The Grinnell College Digital Library Application Developer's Blog</title><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Mark A. McFate"><meta name=description content><link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.bc1abb622a656fb4c816fed09d36c15e272b31b7beae2e7113b2f9418bff0361.css><script type=text/javascript src=https://static.grinnell.edu/dlad-blog/js/pdf-js/build/pdf.js></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Updating Digital.Grinnell in ISLE"><meta name=twitter:description content="Attention: This is an annotated copy of the ISLE project&rsquo;s update.md document. Annotations specific to Digital.Grinnell appear in specially formatted blocks like this one
There was one universal change made here in the original text, specifically all references to master branches have been changed to main to correlate with updated names of the repositories involved in this process.
Note: This update procedure was first performed &ldquo;locally&rdquo;, as recommended on 2021-June-22 when I attempted it on my Grinnell College MacBook Pro, MA10713, serial number C02FK0XXQ05Q."><meta property="og:title" content="Updating Digital.Grinnell in ISLE"><meta property="og:description" content="Attention: This is an annotated copy of the ISLE project&rsquo;s update.md document. Annotations specific to Digital.Grinnell appear in specially formatted blocks like this one
There was one universal change made here in the original text, specifically all references to master branches have been changed to main to correlate with updated names of the repositories involved in this process.
Note: This update procedure was first performed &ldquo;locally&rdquo;, as recommended on 2021-June-22 when I attempted it on my Grinnell College MacBook Pro, MA10713, serial number C02FK0XXQ05Q."><meta property="og:type" content="article"><meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/107-updating-digital-grinnell-in-isle/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-06-22T00:00:00+00:00"><meta property="article:modified_time" content="2021-06-28T13:27:23-05:00"></head><body><header class=app-header><a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a><h2>The Grinnell College Digital Library Application Developer's Blog</h2><div class=author-block><p class=site-rev>Compiled: Feb 17, 2023 at 2:31pm CST<br>Content Updated: 2023-Feb-16 13:07 CST</p><div class=name>by
<strong>Mark A. McFate</strong></div><div class=address>Grinnell College Libraries</div><div class=link><a href=mailto:></a></div><br></div><nav class=sidebar-nav><a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a></nav><p class=site-description>Mark&rsquo;s first Hugo site, a blog, formerly on prem at Static.Grinnell.edu, moved to <em>DigitalOcean</em>, then to <em>Azure</em>, and now hosted on <em>GitHub Pages</em>.</p><div class=app-header-social><a target=_blank href=https://github.com/McFateM><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/gohugoio><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div><p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p></header><main class=app-container><div class=breadcrumbs><a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/107-updating-digital-grinnell-in-isle/>107 updating digital grinnell in isle</a></div><article class=post><header class=post-header><h1 class=post-title>Updating Digital.Grinnell in ISLE</h1><div class=post-meta><script>console.log("Hugo Debug: ",JSON.parse('"2021-06-23T00:00:00Z"'))</script><script>console.log("Hugo Debug: ",JSON.parse('"2021-06-28T13:27:23-05:00"'))</script><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>14 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Jun 22, 2021
&nbsp;&nbsp;&bull;&nbsp;&nbsp;Updated: Jun 28, 2021 13:27
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/isle/>ISLE</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/update/>update</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/ratom/>ratom</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/public/>public</a></div></div><div class=annotation><p style=font-size:1.6em><strong>Attention</strong>: This post has been superseded by <strong><a href=https://static.grinnell.edu/dlad-blog/posts/111-updating-isle-v1.5.11/>posts/111-updating-isle-v1.5.11</a></strong>.</p></div></header><div class=post-content><div class=annotation><p>Attention: This is an annotated copy of the <a href=https://github.com/Islandora-Collaboration-Group/ISLE>ISLE project&rsquo;s</a> <a href=https://github.com/Digital-Grinnell/dg-isle/blob/main/docs/update/update.md>update.md</a> document. Annotations specific to <em>Digital.Grinnell</em> appear in specially formatted blocks like this one</p><p>There was one universal change made here in the original text, specifically all references to <em>master</em> branches have been changed to <em>main</em> to correlate with updated names of the repositories involved in this process.</p></div><div class=annotation><p>Note: This update procedure was first performed &ldquo;locally&rdquo;, as recommended on <code>2021-June-22</code> when I attempted it on my <em>Grinnell College</em> MacBook Pro, <em>MA10713</em>, serial number <em>C02FK0XXQ05Q</em>. **The process failed miserably due to numerous errors, ultimately including&mldr;</p><pre tabindex=0><code>WARNING: Module xdebug ini file doesn&#39;t exist under /etc/php/7.1/mods-available
AH00558: apache2: Could not reliably determine the server&#39;s fully qualified domain name, using 172.22.0.7. Set the &#39;ServerName&#39; directive globally to suppress this message
[Wed Jun 23 00:39:38.868649 2021] [core:emerg] [pid 72604] (95)Operation not supported: AH00023: Couldn&#39;t create the proxy mutex
[Wed Jun 23 00:39:38.870388 2021] [proxy:crit] [pid 72604] (95)Operation not supported: AH02478: failed to create proxy mutex
AH00016: Configuration Failed
Action &#39;-D FOREGROUND&#39; failed.
</code></pre><p>The <code>images-ld</code> container also crashed with lots of <em>Java</em> trash, as <em>Java</em> is apt to do:</p><pre tabindex=0><code>[s6-init] making user provided files available at /var/run/s6/etc...exited 0.
[s6-init] ensuring user provided files have correct perms...exited 0.
[fix-attrs.d] applying ownership &amp; permissions fixes...
[fix-attrs.d] 01-tomcat: applying...
[fix-attrs.d] 01-tomcat: exited 1.
[fix-attrs.d] 11-cantaloupe: applying...
[fix-attrs.d] 11-cantaloupe: exited 0.
[fix-attrs.d] done.
[cont-init.d] executing container initialization scripts...
[cont-init.d] 01-cantaloupe-config: executing...
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO Backend set to env
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO Starting confd
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO Backend source(s) set to
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO /usr/local/cantaloupe/cantaloupe.properties has md5sum 1a486ec62cc9c046b9d61a4d3972cc91 should be 9f84eb40bf531b1714cc616f20e60341
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO Target config /usr/local/cantaloupe/cantaloupe.properties out of sync
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO Target config /usr/local/cantaloupe/cantaloupe.properties has been updated
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO /usr/local/tomcat/conf/logging.properties has mode -rwxr-xr-x should be -rw-r--r--
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO /usr/local/tomcat/conf/logging.properties has md5sum 8edf0889dd7a263984094de9bea3770b should be 943111bb86645471250c7b35ed695ab0
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO Target config /usr/local/tomcat/conf/logging.properties out of sync
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO Target config /usr/local/tomcat/conf/logging.properties has been updated
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO /usr/local/tomcat/conf/tomcat-users.xml has md5sum d04005f593cfc6db810a79766bbf7917 should be 64b2ab19d2455cfd3a36fa5d374baed3
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO Target config /usr/local/tomcat/conf/tomcat-users.xml out of sync
2021-06-23T00:25:09Z b0db6274e175 /usr/local/bin/confd[2461]: INFO Target config /usr/local/tomcat/conf/tomcat-users.xml has been updated
[cont-init.d] 01-cantaloupe-config: exited 0.
[cont-init.d] done.
[services.d] starting services
Starting Tomcat Privileged.
[services.d] done.
#
# A fatal error has been detected by the Java Runtime Environment:
#
#  SIGILL (0x4) at pc=0x000000400ba12b21, pid=2588, tid=0x00000040ea42c700
#
# JRE version: OpenJDK Runtime Environment (8.0_292-b10) (build 1.8.0_292-b10)
# Java VM: OpenJDK 64-Bit Server VM (25.292-b10 mixed mode linux-amd64 compressed oops)
# Problematic frame:
# J 1791 C1 org.apache.catalina.startup.ContextConfig.processAnnotationsStream(Ljava/io/InputStream;Lorg/apache/tomcat/util/descriptor/web/WebXml;ZLjava/util/Map;)V (38 bytes) @ 0x000000400ba12b21 [0x000000400ba12ac0+0x61]
#
# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try &#34;ulimit -c unlimited&#34; before starting Java again
#
# An error report file with more information is saved as:
# /run/s6/services/tomcat/hs_err_pid2588.log
Compiled method (c1)   25034 1791       3       org.apache.catalina.startup.ContextConfig::processAnnotationsStream (38 bytes)
 total in heap  [0x000000400ba128d0,0x000000400ba13a40] = 4464
 relocation     [0x000000400ba129f8,0x000000400ba12ab8] = 192
 main code      [0x000000400ba12ac0,0x000000400ba13440] = 2432
 stub code      [0x000000400ba13440,0x000000400ba13518] = 216
 oops           [0x000000400ba13518,0x000000400ba13520] = 8
 metadata       [0x000000400ba13520,0x000000400ba13558] = 56
 scopes data    [0x000000400ba13558,0x000000400ba13908] = 944
 scopes pcs     [0x000000400ba13908,0x000000400ba13a38] = 304
 dependencies   [0x000000400ba13a38,0x000000400ba13a40] = 8
#
# If you would like to submit a bug report, please visit:
#   https://github.com/AdoptOpenJDK/openjdk-support/issues
#
qemu: uncaught target signal 6 (Aborted) - core dumped
Aborted
[cont-finish.d] executing container finish scripts...
[cont-finish.d] done.
[s6-finish] waiting for services.
[s6-finish] sending all processes the TERM signal.
[s6-finish] sending all processes the KILL signal and exiting.
</code></pre><p>Rather than diving down this rabbit hole I elected to attempt this update on our <em>staging</em> server, <em>DGDockerX</em>.</p></div><h1 id=update-isle-to-the-latest-release>Update ISLE to the Latest Release</h1><p>Update an existing ISLE installation to install the newest improvements and security updates. This process is intended to be backwards compatible with your existing ISLE site.</p><p>We strongly recommend that you begin the update process on your Local environment so that you may test and troubleshoot before proceeding to update your Staging and Production environments.</p><h2 id=important-information>Important Information</h2><ul><li>These instructions assume you have already installed either the <a href=../install/install-local-new.md>Local ISLE Installation: New Site</a> or the <a href=../install/install-local-migrate.md>Local ISLE Installation: Migrate Existing Islandora Site</a> on your Local personal computer and are using that described git workflow.</li><li>Please test these updates on your Local and Staging environments before updating your Production server.</li><li>Always read the <a href=../release-notes/release-1-4-1.md>Release Notes</a> for any version(s) newer than that which you are currently running.</li><li><strong>Docker Desktop Update:</strong> If Docker prompts that updates are available for your personal computer, please follow these steps:<ol><li>Go to your Local ISLE site: <code>docker-compose down</code></li><li>Install the new updated version(s) of Docker Desktop.</li><li>Go to your Local ISLE site: <code>docker-compose up -d</code></li></ol></li></ul><div class=annotation><pre tabindex=0><code># stop the docker service
$ sudo service docker stop

# download the latest docker binary and replace the current outdated docker
# DEPRECATED WAY TO UPGRADE DOCKER: $ sudo wget https://get.docker.com/builds/Linux/x86_64/docker-latest -O /usr/bin/docker
$ sudo yum update docker-engine

# start the docker service
$ sudo service docker start

# check the version
$ sudo docker version

# check the images and containers
$ sudo docker images
$ sudo docker ps
$ sudo docker ps -a
</code></pre></div><h2 id=update-local-personal-computer>Update Local (personal computer)</h2><div class=annotation><p>As mentioned above, this work is being conducted in <em>staging</em> rather than <em>local</em>, on <em>DGDockerX</em> in the <code>/home/islandora/ISLE</code> directory and the <code>dg-isle</code> and <code>dg-islandora</code> directories there.</p></div><ul><li><p>On your Local (personal computer) server, open a terminal (Windows: open Git Bash) and navigate to your Local ISLE repository (this contains the &ldquo;docker-compose.local.yml&rdquo; file):</p><ul><li><strong>Example:</strong> <code>cd /path/to/your/repository</code></li></ul></li><li><p>Stop the existing ISLE containers:</p><ul><li><code>docker-compose down</code></li></ul></li><li><p>Check your git remotes:</p><ul><li><code>git remote -v</code></li></ul></li><li><p>If you do not have a remote named &ldquo;icg-upstream&rdquo; then create one:</p><ul><li><code>git remote add icg-upstream https://github.com/Islandora-Collaboration-Group/ISLE.git</code></li></ul></li><li><p>Run a git fetch from the ICG upstream:</p><ul><li><code>git fetch icg-upstream</code></li></ul></li><li><p>Checkout a new git branch as a precaution for performing the update on your project. This way your &ldquo;main&rdquo; branch stays safe and untouched until you have tested thoroughly and are ready to merge in changes from the recent update. You may select any name for your new local branch.</p><ul><li><strong>Example:</strong> <code>git checkout -b isle-update-numberhere</code></li></ul></li></ul><div class=annotation><p>My new branch is named <code>isle-update-1.5.7</code>.</p></div><ul><li>Pull down the ICG ISLE &ldquo;main&rdquo; branch into your Local project&rsquo;s new &ldquo;isle-update-numberhere&rdquo; branch:<ul><li><code>git pull icg-upstream main</code></li></ul></li></ul><div class=annotation><p>I pulled <code>icg-upstream main</code> rather than <em>master</em>.</p></div><ul><li>In your ISLE directory, you may view the newest release of ISLE code by entering:<ul><li><code>ls -lha</code></li></ul></li><li>Now that you have pulled down the latest code, there are likely to be conflicts between your existing code and the newer code. Run this command to determine if there are git merge conflicts:<ul><li><code>git status</code></li></ul></li></ul><div class=annotation><p>Output from <code>git pull</code> follows.</p><pre tabindex=0><code>╭─islandora@dgdockerx ~/ISLE/dg-isle ‹isle-update-1.5.7›
╰─$ git pull icg-upstream main
From https://github.com/Islandora-Collaboration-Group/ISLE
 * branch            main       -&gt; FETCH_HEAD
Auto-merging staging.env
Auto-merging scripts/apache/migration_site_vsets.sh
CONFLICT (content): Merge conflict in scripts/apache/migration_site_vsets.sh
Auto-merging production.env
Auto-merging local.env
Removing docs/specifications/supported-software-matrix.md
Removing docs/specifications/supported-drupal-modules-matrix.md
Auto-merging docs/install/install-staging-migrate.md
Auto-merging docs/install/install-local-migrate.md
CONFLICT (content): Merge conflict in docs/install/install-local-migrate.md
Auto-merging docs/install/host-software-dependencies.md
Removing docs/install/_obsolete_install-server.md
Removing docs/contributor-docs/build-guide.md
Removing docs/contributor-docs/build-guide-v111.md
Removing docs/contributor-docs/ansible-guide.md
Removing docs/contributor-docs/ISLE-v.1.1.2-buildnotes.md
Removing docs/appendices/user-story-new-site.md
Removing docs/appendices/user-story-migration-site.md
Removing docs/appendices/user-story-demo-site.md
Auto-merging docker-compose.staging.yml
Auto-merging docker-compose.production.yml
Auto-merging docker-compose.local.yml
Auto-merging config/proxy/traefik.staging.toml
CONFLICT (content): Merge conflict in config/proxy/traefik.staging.toml
Auto-merging config/proxy/traefik.production.toml
CONFLICT (content): Merge conflict in config/proxy/traefik.production.toml
Auto-merging config/proxy/traefik.local.toml
Automatic merge failed; fix conflicts and then commit the result.
</code></pre></div><ul><li>If there are any merge conflicts, then use a text editor (or IDE) to resolve them. (The <a href=https://atom.io/>Atom</a> text editor offers green and red buttons to facilitate this process.) Some releases will have more merge conflicts than others. Carefully progress through this process of resolving merge conflicts. Changes will usually include but are not limited to:<ul><li>new configuration files</li><li>new ISLE services optional or otherwise</li><li>new ISLE docker image tags</li><li>new comments</li><li>new documentation</li></ul></li></ul><div class=annotation><p>I used <code>ratom</code> (see <a href=http://static.grinnell.edu/blogs/McFateM/posts/085-remote-atom/>Remote Atom</a>) to resolve the 4 merge conflicts.</p></div><ul><li><p>After all merge conflicts are resolved, then add and commit your edits to your Local environment:</p><ul><li><strong>Example:</strong> <code>git add &lt;changedfileshere></code></li><li><strong>Example:</strong> <code>git commit -m "ISLE update from version #X to version #Y"</code></li></ul></li><li><p>Optional: If you want to backup this new branch to your origin, then run this command: (Ultimately after testing on your Local, you&rsquo;ll merge to <code>main</code> and then deploy the new code to your Staging and Production environments.)</p><ul><li><strong>Example:</strong> <code>git push origin isle-update-numberhere</code></li></ul></li><li><p>Using the same open terminal, ensure you are in the root of your ISLE project directory:</p><ul><li><strong>Example:</strong> <code>cd /path/to/your/repository</code></li></ul></li><li><p>Download the new ISLE docker images to the Local (personal computer):</p><ul><li><code>docker-compose pull</code></li></ul></li></ul><div class=annotation><p>There really should be an additional step here since you <strong>must edit</strong>, or at least check your <code>.env</code> file! I changed mine to read as follows:</p><pre tabindex=0><code>COMPOSE_PROJECT_NAME=dgs
BASE_DOMAIN=isle-stage.grinnell.edu
CONTAINER_SHORT_ID=dgs
COMPOSE_FILE=docker-compose.staging.yml
</code></pre></div><ul><li><p>Run the new docker containers (and new code) on your Local environment:</p><ul><li><code>docker-compose up -d</code></li></ul></li><li><p>In your web browser, enter the URL of your Local site:</p><ul><li><strong>Example:</strong> <code>https://yourprojectnamehere.localdomain</code></li></ul></li></ul><div class=annotation><p>With an active VPN connection, I am happy to report that the <em>staging</em> site is now working at <a href=https://isle-stage.grinnell.edu>https://isle-stage.grinnell.edu</a>. However, I&rsquo;m getting tired or accepting the self-signed certs used in staging, so I found and executed <a href=https://medium.com/volosoft/how-to-disable-firefox-warning-potential-security-risk-ahead-f081fbf81a4f>How to disable Firefox: “Warning: Potential Security Risk Ahead” forever</a>.</p></div><ul><li>Quality control (QC) the Local site and ensure the following:<ul><li>The site appears and functions as it did prior to these updates.</li><li>You can ingest test objects without any issue.</li><li>You can modify existing object data without any issue.</li><li>All services are functional and without apparent ERROR warnings in the browser log console output.<ul><li><strong>Example:</strong> In Chrome, press the F12 button to open the <a href=https://developers.google.com/web/tools/chrome-devtools/console/>Console</a>, then select the &ldquo;Console&rdquo; tab.</li></ul></li></ul></li></ul><div class=annotation><p>Preliminary tests look good, although a search for &ldquo;Ley&rdquo; still returns a number of objects that <em>do not exist</em> in my <em>DG-STAGING</em> test repository. I&rsquo;m going to attempt to re-index FGS and Solr to see if I can fix that now.</p><p>Nope, the Fedora and Solr update scripts did not resolve this issue. Next up, <a href=http://dgdockerx.grinnell.edu:8081/fedoragsearch/rest>http://dgdockerx.grinnell.edu:8081/fedoragsearch/rest</a> and login as <code>fgsAdmin</code>. That opens the <em>Admin Client for Fedora Generic Search Service</em> where I can hope to empty the index and rebuild. Nope, the <code>createEmpty</code> option returns a message telling me to <code>createEmpty: Stop solr, remove the index dir, restart solr</code>. So I opened a shell into the <code>isle-solr-dgs</code> container and did <code>root@d7e1538334f6:/usr/local/solr/collection1/data# rm -fr index</code>. Then I tried the rebuild scripts again, but this also did NOT work.</p><p>Ultimately, after deleting the aforementioned directory, I had to bring the stack down and back up again (using <code>~/DG-STAGING/destroy.sh</code> and <code>~/DG-STAGING/RESTART.sh</code>), then rebuild <em>Fedora</em> and update <em>Solr</em>. Now I have an accurate, abbreviated <em>Solr</em> return list!</p></div><ul><li><p>When you have completed testing and have no further adjustments to make, switch from your &ldquo;isle-update-numberhere&rdquo; branch of code to your &ldquo;main&rdquo; branch:</p><ul><li><code>git checkout main</code></li></ul></li><li><p>Merge your &ldquo;isle-update-numberhere&rdquo; branch of code to &ldquo;main&rdquo;.</p><ul><li><strong>Example:</strong> <code>git merge isle-update-numberhere</code></li></ul></li><li><p>Push this code to your online git provider ISLE</p><ul><li><code>git push -u origin main</code></li><li>This will take 2-5 minutes depending on your internet speed.</li></ul></li></ul><div class=annotation><p>I wasn&rsquo;t able to execute the sequence as presented above. Instead, I did this:</p><pre tabindex=0><code>╭─islandora@dgdockerx ~/ISLE/dg-isle
╰─$ git add .
╭─islandora@dgdockerx ~/ISLE/dg-isle
╰─$ git commit -m &#34;Updated and working on DGDockerX&#34;
╭─islandora@dgdockerx ~/ISLE/dg-isle
╰─$ git push origin isle-update-1.5.7
</code></pre></div><ul><li>You now have the current ISLE project code checked into git; this will be the foundation for making changes to your Staging and Production servers.</li></ul><div class=annotation><p>During my updates to <em>DGDockerX</em> I had network interruptions that left processes on the remote holding on to port 52698, the port that I need to make <em>ratom</em> work. I found this simple means of freeing up that port&mldr;</p><pre tabindex=0><code>╭─islandora@dgdockerx ~
╰─$ sudo netstat -plant | grep 52698
tcp        0      0 127.0.0.1:52698         0.0.0.0:*               LISTEN      121885/sshd: island
tcp6       0      0 ::1:52698               :::*                    LISTEN      121885/sshd: island
tcp6       0      0 ::1:41724               ::1:52698               ESTABLISHED 24103/bash
tcp6       0      0 ::1:52698               ::1:41724               ESTABLISHED 121885/sshd: island
tcp6       0      0 ::1:52698               ::1:41382               ESTABLISHED 121885/sshd: island
tcp6       0      0 ::1:41400               ::1:52698               ESTABLISHED 122118/bash
tcp6       0      0 ::1:41610               ::1:52698               ESTABLISHED 23600/bash
tcp6       0      0 ::1:41382               ::1:52698               ESTABLISHED 122040/bash
tcp6       0      0 ::1:52698               ::1:41400               ESTABLISHED 121885/sshd: island
tcp6       0      0 ::1:52698               ::1:41610               ESTABLISHED 121885/sshd: island
╭─islandora@dgdockerx ~
╰─$ sudo kill -9 121885
</code></pre></div><div class=annotation><p>Hold on, there&rsquo;s one more significant part of the update process that&rsquo;s not covered here, updating the <em>Drupal</em> and <em>Islandora</em> code that is not technically part of <em>ISLE</em>, but probably should be?</p><p>My process for updating that went something like this:</p><pre tabindex=0><code>╭─islandora@dgdockerx ~
╰─$ cd ~/ISLE/dg-islandora
╭─islandora@dgdockerx ~/ISLE/dg-islandora
╰─$ git checkout -b update-june-23
╭─islandora@dgdockerx ~/ISLE/dg-islandora ‹update-june-23*›
╰─$ docker exec -it isle-apache-dgs bash
root@03df8d9c975a:/# cd /var/www/html/sites/default/
root@03df8d9c975a:/var/www/html/sites/default# drush up
</code></pre><p>The <code>drush up</code> command was invoked to pull in all of the latest updates to <em>Drupal</em> v7, and there were many, including an update to <em>Drupal</em>&rsquo;s core. Since the core got updated, I had to eventually revert changes to <code>/var/www/html/.htaccess</code> since those updates typically remove a line that <em>ISLE</em> requires to function properly. I confirmed that the changes made by <code>drush up</code> did indeed make their way into <code>~/ISLE/dg-islandora</code> by checking <code>git status</code>. I managed to revert the changes to <code>.htaccess</code> using <code>git checkout -- .htaccess</code>.</p><p>After making those changes I found it necessary to restart the stack using:</p><pre tabindex=0><code>╭─islandora@dgdockerx ~/ISLE/dg-islandora ‹update-june-23*›
╰─$ cd ~/DG-STAGING
╭─islandora@dgdockerx ~/DG-STAGING ‹main*›
╰─$ ./RESTART.sh
</code></pre><p>I subsequently had to run several of the <code>./Update-*.sh</code> scripts in <code>~/DG-STAGING</code> in order to get everything working properly. Once everything was working properly I pushed my <code>dg-islandora</code> changes to <em>Github</em> using:</p><pre tabindex=0><code>╭─islandora@dgdockerx ~/ISLE/dg-islandora ‹update-june-23*›
╰─$ git add --all .
╭─islandora@dgdockerx ~/ISLE/dg-islandora ‹update-june-23*›
╰─$ git commit -m &#34;Updates from DGDockerX&#34;
[update-june-23 f8e3cd8] Updates from DGDockerX
 232 files changed, 3498 insertions(+), 1283 deletions(-)
 rewrite modules/simpletest/files/css_test_files/comment_hacks.css.optimized.css (100%)
 create mode 100644 modules/simpletest/files/css_test_files/quotes.css
 create mode 100644 modules/simpletest/files/css_test_files/quotes.css.optimized.css
 create mode 100644 modules/simpletest/files/css_test_files/quotes.css.unoptimized.css
 mode change 100755 =&gt; 100644 sites/all/libraries/tuque/tests/README.md
 mode change 100755 =&gt; 100644 sites/all/libraries/tuque/tests/scripts/travis_setup.sh
 create mode 100644 sites/all/modules/contrib/link/link.admin.inc
 rewrite sites/all/modules/contrib/link/link.info (61%)
 rename sites/all/modules/contrib/link/tests/{link.test =&gt; LinkBaseTestClass.test} (85%)
 create mode 100644 sites/all/modules/contrib/link/tests/LinkConvertInternalPathsTest.test
 create mode 100644 sites/all/modules/contrib/link/tests/LinkDefaultProtocolTest.test
 rename sites/all/modules/contrib/link/tests/{link.entity_token.test =&gt; LinkEntityTokenTest.test} (98%)
 rename sites/all/modules/contrib/link/tests/{link.attribute.test =&gt; LinkFieldAttributesTest.test} (96%)
 rename sites/all/modules/contrib/link/tests/{link.crud_browser.test =&gt; LinkFieldCrudTest.test} (87%)
 rename sites/all/modules/contrib/link/tests/{link.validate.test =&gt; LinkFieldValidateTest.test} (60%)
 rename sites/all/modules/contrib/link/tests/{link.multilingual.test =&gt; LinkPathPrefixesTest.test} (98%)
 create mode 100644 sites/all/modules/contrib/link/tests/LinkSanitizeTest.test
 rename sites/all/modules/contrib/link/tests/{link.token.test =&gt; LinkTokenTest.test} (99%)
 create mode 100644 sites/all/modules/contrib/link/tests/LinkUnitTestCase.test
 create mode 100644 sites/all/modules/contrib/link/tests/LinkValidationApiTest.test
 delete mode 100644 sites/all/modules/contrib/link/tests/link.crud.test
╭─islandora@dgdockerx ~/ISLE/dg-islandora ‹update-june-23›
╰─$ git pull origin main                               
Username for &#39;https://github.com&#39;: digital@grinnell.edu
Password for &#39;https://digital@grinnell.edu@github.com&#39;:  xxxxxxxxxxxxxxxxxxxxxxxx
From https://github.com/Digital-Grinnell/dg-islandora
 * branch            main       -&gt; FETCH_HEAD
Merge made by the &#39;recursive&#39; strategy.
 .htaccess                                     |  13 +++++++--
 sites/all/modules/islandora/idu/idu.drush.inc | 133 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++--
 2 files changed, 142 insertions(+), 4 deletions(-)
</code></pre><p>At this point I did another <code>cd ~/DG-STAGING; ./RESTART.sh</code> just to ensure things still work properly. Another <code>./Update-PERMISSIONS.sh</code> was also needed.</p><p>Then&mldr;</p><pre tabindex=0><code>╭─islandora@dgdockerx ~/ISLE/dg-islandora ‹update-june-23›
╰─$ git push origin update-june-23  
Username for &#39;https://github.com&#39;: digital@grinnell.edu
Password for &#39;https://digital@grinnell.edu@github.com&#39;: xxxxxxxxxxxxxxx
Counting objects: 660, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (348/348), done.
Writing objects: 100% (352/352), 102.29 KiB | 0 bytes/s, done.
Total 352 (delta 288), reused 1 (delta 0)
remote: Resolving deltas: 100% (288/288), completed with 261 local objects.
remote:
remote: Create a pull request for &#39;update-june-23&#39; on GitHub by visiting:
remote:      https://github.com/Digital-Grinnell/dg-islandora/pull/new/update-june-23
remote:
To https://github.com/Digital-Grinnell/dg-islandora
 * [new branch]      update-june-23 -&gt; update-june-23
</code></pre></div><h2 id=update-staging-server>Update Staging Server</h2><div class=annotation><p>Ok, at this point I&rsquo;ve already got our staging server up-to-date, including the addtion of my <code>purge-tmp-files</code> script successfully added to the Apache container&rsquo;s <code>/etc/cron.hourly</code> directory. So my next steps will be to backup the production database and <code>/var/www/html/sites/default/files</code>, merge all of the <code>dg-isle</code> and <code>dg-islandora</code> repository changes into their respective <code>main</code> branches, and repeat all of my implementation and testing in staging again.</p></div><ul><li><p>SSH into your Staging ISLE Host Server:</p><ul><li><strong>Example:</strong> <code>ssh islandora@yourstagingserver.institution.edu</code></li><li><strong>Example:</strong> <code>cd /opt/yourprojecthere</code></li></ul></li><li><p>Stop the existing ISLE containers:</p><ul><li><code>docker-compose down</code></li></ul></li><li><p>Update the Docker files via git:</p><ul><li><code>git pull origin main</code></li></ul></li></ul><ul><li><p>You must now again fix the <code>.env</code> file as you did in the <code>On Remote Staging - Edit the ".env" File to Change to the Staging Environment</code> step of either the <a href=../install/install-staging-new.md>Staging ISLE Installation: New Site</a> or the <a href=../install/install-staging-migrate.md>Staging ISLE Installation: Migrate Existing Islandora Site</a> instructions. As described, this step is a multi-step, involved process that allows an end-user to make appropriate changes to the <code>.env</code> and then commit it locally to git. This local commit will never be pushed back to the git repository and this is critical because it allows future ISLE updates and/or configuration changes. In other words, you are restoring what you had in the <code>.env</code> to the Staging settings in case they are overwritten.</p></li><li><p>Download the new ISLE docker images to the remote Staging environment:</p><ul><li><code>docker-compose pull</code></li><li>This may take a few minutes depending on your network connection</li></ul></li><li><p>Run the new docker containers (and new code) on your Staging environment:</p><ul><li><code>docker-compose up -d</code></li></ul></li></ul><p>The new containers should start up and your Staging Islandora site should be available, without any loss of existing content.</p><div class=annotation><p>I used the <code>/home/islandora/DG-STAGING/RESTART.sh</code> script on <em>DGDockerX</em> to restart the stack after capturing the production database and <code>/var/www/html/sites/default/files</code> contents. It worked nicely! It did require one run of the <code>/home/islandora/DG-STAGING/Update-PERMISSIONS.sh</code> script to get everything set.</p><p>Next update will be to our production server, <em>DGDocker1</em>, where I hope to repeat this process <strong>to-the-letter</strong>.</p></div><ul><li><p>QC the Staging site and ensure the following:</p><ul><li>The site appears and functions as it did prior to these updates.</li><li>You can ingest test objects without any issue.</li><li>You can modify existing object data without any issue.</li><li>All services are functional and without apparent ERROR warnings in the browser log console output.</li></ul></li><li><p>We recommend that you observe the above Staging installation for a few days or a week.</p></li></ul><h2 id=update-production-server>Update Production Server</h2><p>When you are confident that your Staging installation is working as expected:</p><ul><li>Repeat the same above &ldquo;Update Staging Server&rdquo; process but do so on your Production server environment.</li></ul><h2 id=additional-resources>Additional Resources</h2><p>Please post questions to the public <a href=https://groups.google.com/forum/#!forum/islandora-isle>Islandora ISLE Google group</a>, or subscribe to receive emails.</p><div class=annotation><p>One hiccup in the <code>production</code> update&mldr; I encountered this error when trying to initiate an IMI import:</p><pre tabindex=0><code>RuntimeException: Unable to create the cache directory (/var/www/private/ed). in Twig\Cache\FilesystemCache-&gt;write() (line 57 of /var/www/html/sites/all/modules/islandora/islandora_multi_importer/vendor/twig/twig/src/Cache/FilesystemCache.php).
</code></pre><p>The problem appeared to be ownership of the <code>/var/www/public</code> directory in the <em>Apache</em> container. The <code>public</code> folder was owned by <code>islandora:islandora</code> so I opened a shell into <em>Apache</em> and did <code>cd /var/www/; chown -R islandora:www-data public</code>. That seems to have fixed the problem nicely.</p></div><h1 id=end-of-update-isle-to-the-latest-release>End of: Update ISLE to the Latest Release</h1><p>And that&rsquo;s a wrap. Until next time&mldr;</p></div><div class=post-footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//digital-library-applications-developer-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></main></body></html>