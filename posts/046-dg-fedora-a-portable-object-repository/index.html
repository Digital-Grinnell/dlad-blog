<!doctype html><html lang=en><head><title>DG-FEDORA: A Portable FEDORA Repository // The Grinnell College Digital Library Application Developer's Blog</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.143.1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Mark A. McFate"><meta name=description content><link rel=stylesheet href=https://static.grinnell.edu/dlad-blog/css/main.min.5efe2f062080343a28f3b21576ff0c6dbf2b0a5d89ed855f45479992bd62d0e6.css><script type=text/javascript src=https://static.grinnell.edu/dlad-blog/js/pdf-js/build/pdf.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=288703662"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","288703662")}</script><meta name=twitter:card content="summary"><meta name=twitter:title content="DG-FEDORA: A Portable FEDORA Repository"><meta name=twitter:description content="Teaser Late last night (don’t ask how late it was) I discovered a really slick trick, aka “feature”, of docker-compose. Full disclosure: I love docker-compose “overrides”, a feature I found a couple of months ago. However, implementing overrides in a granular fashion, as I’d like, and within a docker-compose hierarchy of environments like the ISLE stack, can be difficult and counter-productive. I may have found a workable compromise last night. If you’re interested, please, read on…
History About a year ago I created a “portable” FEDORA object repository “on a stick”, a USB stick. I call that “stick” DG-FEDORA, because it contains a number of sample objects gleaned from Digital.Grinnell.edu. Shortly after I created the “stick” I started using a docker-compose.override.yml file (see Adding and overriding configuration for details) to implement it in some of my ISLE work. But there were lots of other “customizations” that I also wanted to implement, and over time my docker-compose.override.yml grew too large to be easily maintained…there was just too much stuff to squeeze into a file that was supposed to make life easier."><meta property="og:url" content="https://static.grinnell.edu/dlad-blog/posts/046-dg-fedora-a-portable-object-repository/"><meta property="og:site_name" content="The Grinnell College Digital Library Application Developer's Blog"><meta property="og:title" content="DG-FEDORA: A Portable FEDORA Repository"><meta property="og:description" content="Teaser Late last night (don’t ask how late it was) I discovered a really slick trick, aka “feature”, of docker-compose. Full disclosure: I love docker-compose “overrides”, a feature I found a couple of months ago. However, implementing overrides in a granular fashion, as I’d like, and within a docker-compose hierarchy of environments like the ISLE stack, can be difficult and counter-productive. I may have found a workable compromise last night. If you’re interested, please, read on…
History About a year ago I created a “portable” FEDORA object repository “on a stick”, a USB stick. I call that “stick” DG-FEDORA, because it contains a number of sample objects gleaned from Digital.Grinnell.edu. Shortly after I created the “stick” I started using a docker-compose.override.yml file (see Adding and overriding configuration for details) to implement it in some of my ISLE work. But there were lots of other “customizations” that I also wanted to implement, and over time my docker-compose.override.yml grew too large to be easily maintained…there was just too much stuff to squeeze into a file that was supposed to make life easier."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-09-16T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-23T10:43:02-05:00"><meta property="article:tag" content="DG-FEDORA"><meta property="article:tag" content="FEDORA"><meta property="article:tag" content="Portable"><meta property="article:tag" content="Docker-Compose"><meta property="article:tag" content="Override"><meta property="article:tag" content="COMPOSE_FILE"><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://analytics.summittservices.com/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","16"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></head><body><header class=app-header><a href=https://static.grinnell.edu/dlad-blog/><img class=app-header-avatar src=https://static.grinnell.edu/dlad-blog/avatar.jpg alt="Mark A. McFate"></a><h2>The Grinnell College Digital Library Application Developer's Blog</h2><div class=author-block><p class=site-rev>Compiled: Feb 12, 2025 at 8:20pm CST<br>Content Updated: 2025-Feb-12 19:38 CST</p><div class=name>by
<strong>Mark A. McFate</strong></div><div class=address>Grinnell College Libraries</div><div class=link><a href=mailto:></a></div><br></div><nav class=sidebar-nav><a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/search/ title>Search This Blog</a>
<a class=sidebar-nav-item href=https://static.grinnell.edu/dlad-blog/about/ title>About Me</a></nav><p class=site-description>Mark&rsquo;s first Hugo site, a blog, formerly on prem at Static.Grinnell.edu, moved to <em>DigitalOcean</em>, then to <em>Azure</em>, and now hosted on <em>GitHub Pages</em>.</p><div class=app-header-social><a target=_blank href=https://github.com/McFateM><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>
<a target=_blank href=https://twitter.com/gohugoio><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div><p class=copyright>The views and opinions expressed on this site belong solely to the original author(s) and do not necessarily represent or reflect those of Grinnell College.</p></header><main class=app-container><div class=breadcrumbs><a href=https://static.grinnell.edu/dlad-blog/>Home</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/>Posts</a>
&bull; <a href=https://static.grinnell.edu/dlad-blog/posts/046-dg-fedora-a-portable-object-repository/>046 dg fedora a portable object repository</a></div><article class=post><header class=post-header><h1 class=post-title>DG-FEDORA: A Portable FEDORA Repository</h1><div class=post-meta><script>console.log("Hugo Debug: ",JSON.parse('"2019-09-17T00:00:00Z"'))</script><script>console.log("Hugo Debug: ",JSON.parse('"2019-12-23T10:43:02-05:00"'))</script><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
7 min read
&nbsp;&nbsp;&bull;&nbsp;&nbsp;
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Sep 16, 2019
&nbsp;&nbsp;&bull;&nbsp;&nbsp;Updated: Dec 23, 2019 10:43
&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-at-sign"><title>at-sign</title><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 006 0v-1a10 10 0 10-3.92 7.94"/></svg> Mark A. McFate</strong><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=https://static.grinnell.edu/dlad-blog/tags/dg-fedora/>DG-FEDORA</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/fedora/>FEDORA</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/portable/>Portable</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/docker-compose/>Docker-Compose</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/override/>Override</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/compose_file/>COMPOSE_FILE</a><a class=tag href=https://static.grinnell.edu/dlad-blog/tags/re-index/>Re-Index</a></div></div></header><div class=post-content><h2 id=teaser>Teaser</h2><p>Late last night (don&rsquo;t ask how late it was) I discovered a really slick trick, aka &ldquo;feature&rdquo;, of <em>docker-compose</em>. Full disclosure: I love <em>docker-compose</em> &ldquo;overrides&rdquo;, a feature I found a couple of months ago. However, implementing overrides in a granular fashion, as I&rsquo;d like, and within a <em>docker-compose</em> hierarchy of environments like the <a href=https://github.com/Islandora-Collaboration-Group/ISLE>ISLE</a> stack, can be difficult and counter-productive. I may have found a workable compromise last night. If you&rsquo;re interested, please, read on&mldr;</p><h2 id=history>History</h2><p>About a year ago I created a &ldquo;portable&rdquo; <em>FEDORA</em> object repository &ldquo;on a stick&rdquo;, a USB stick. I call that &ldquo;stick&rdquo; <em>DG-FEDORA</em>, because it contains a number of sample objects gleaned from <a href=https://digital.grinnell.edu>Digital.Grinnell.edu</a>. Shortly after I created the &ldquo;stick&rdquo; I started using a <em>docker-compose.override.yml</em> file (see <a href=https://docs.docker.com/compose/extends#adding-and-overriding-configuration>Adding and overriding configuration</a> for details) to implement it in some of my <em>ISLE</em> work. But there were lots of other &ldquo;customizations&rdquo; that I also wanted to implement, and over time my <em>docker-compose.override.yml</em> grew too large to be easily maintained&mldr;there was just too much stuff to squeeze into a file that was supposed to make life easier.</p><h2 id=isle-details>ISLE Details</h2><p>The <em>ISLE</em> stack now uses a very simple and elegant <em>.env</em> file &ndash; four lines of environment variables, nothing more &ndash; to ultimately control what the <em>docker-compose</em> command does. The last environment variable in the file is <code>COMPOSE_FILE</code>, and I found that this variable can be used to specify &ldquo;multiple&rdquo; <em>.yml</em> files to build a stack; and <em>docker-compose</em> does so using a well-documented and sensible set of rules. Nirvana!</p><h2 id=the-solution>The Solution</h2><p>So what I&rsquo;ve done is simply provide a modified <em>.env</em> file and some instruction for using it properly. My <em>.env</em> file (there is a copy of it on the <em>DG-FEDORA</em> USB stick) reads like this:</p><pre tabindex=0><code>#### Activated ISLE environment
# To use an environment other than the default Demo, please change values below
# from the default Demo to one of the following: Local, Test, Staging or Production
# For more information, consult https://islandora-collaboration-group.github.io/ISLE/install/install-environments/

COMPOSE_PROJECT_NAME=isle_demo
BASE_DOMAIN=isle.localdomain
CONTAINER_SHORT_ID=ld
# COMPOSE_FILE=docker-compose.demo.yml
COMPOSE_FILE=docker-compose.demo.yml:docker-compose.DG-FEDORA.yml
</code></pre><p>In the file above, note that I&rsquo;ve commented out the original definition of <em>COMPOSE_FILE</em> and added my own definition which appends a second <em>.yml</em> file reference to the original. That 2nd file, <em>docker-compose.DG-FEDORA.yml</em> is also provided on the <em>DG-FEDORA</em> USB stick and it reads like this:</p><pre tabindex=0><code>version: &#39;3.7&#39;

#### docker-compose up -d;
## Local Environment - Used for Drupal site development, more extensive metadata, Solr and Fedora development work on a local laptop or workstation
## Updated 2019-09 - Release 1.3.0-dev (@ 1.3.0-dev)

services:

  # Bind-mount the datastreamStore and objectStore directories in /Volumes/DG-FEDORA (the USB stick)
  #  into the FEDORA container to become our FEDORA datastream and object store directories.  FEDORA digital
  #  live in these directories, so this effectively puts your FEDORA repository on the DG-FEDORA stick.

  fedora:
    volumes:
      - /Volumes/DG-FEDORA/datastreamStore:/usr/local/fedora/data/datastreamStore
      - /Volumes/DG-FEDORA/objectStore:/usr/local/fedora/data/objectStore

  # Bind-mount the /Volumes/DG-FEDORA/Storage directory tree in the Apache container. This bind-mount to /mnt/storage
  #  is usefule with IMI, the Islandora Multi-Importer when a local* file fetch hook is defined, as it is in the DG7
  #  custom module.

  apache:
    volumes:
      - /Volumes/DG-FEDORA/Storage:/mnt/storage
</code></pre><p>Simple. It&rsquo;s just a repeat of the original <em>docker-compose.demo.yml</em> file with only the necessary &ldquo;overrides&rdquo; included.</p><p>The <em>DG-FEDORA</em> USB stick also includes a <em>README.md</em> file and since you don&rsquo;t have a copy of the &ldquo;stick&rdquo;, I&rsquo;ll share that with you here.</p><h1 id=a-master-copy-of-_dg-fedora_>A Master Copy of <em>DG-FEDORA</em></h1><p>My <em>Digital.Grinnell</em> staging server, <em>DGDockerX</em> is a networked <em>CentOS 7</em> virtual machine with lots of available storage, but no accessible USB ports, of course&mldr;it&rsquo;s a VM after all. Consequently, it&rsquo;s not practical to maintain all of my &ldquo;portable&rdquo; <em>FEDORA</em> data on a USB stick alone. So, on <em>DGDockerX</em> I&rsquo;ve created a copy of the <em>DG-FEDORA</em> USB stick at <code>/mnt/data/DG-FEDORA</code>, and I&rsquo;ve declared it to be copy &ldquo;zero&rdquo;, so on it there&rsquo;s a <code>DG-FEDORA-0.md</code> file proclaiming it to be the &ldquo;master&rdquo; copy of <em>DG-FEDORA</em>.</p><p>It&rsquo;s worth noting, perhaps, that at the time of this writing, <em>DG-FEDORA-0</em> contains 126 <em>FEDORA</em> objects. <strong>Anything less than that number should be considered an incomplete set</strong>.</p><p>The <code>README.md</code> file in the <code>DG-FEDORA-0</code> <strong>MASTER</strong> volume suggests using a command like this to copy the <strong>MASTER</strong> repository to a mounted <code>DG-FEDORA</code> USB stick:</p><pre tabindex=0><code>sudo rsync -aruvi --exclude DG-FEDORA-0.md --exclude from-DGDocker1 --exclude site-public islandora@132.161.132.101:/mnt/data/DG-FEDORA/. /Volumes/DG-FEDORA/. --progress
</code></pre><h1 id=readmemd-from-dg-fedora>README.md from DG-FEDORA</h1><p><em>DG-FEDORA</em> is the name of a USB stick/volume (I actually maintain 2 USB memory sticks named <em>DG-FEDORA</em>, numbers 1 and 2) which holds a small sample of FEDORA digital objects gleaned from <a href=https://digital.grinnell.edu>Digital.Grinnell</a>. Using <em>DG-FEDORA</em> you can easily add a pre-populated repository of objects to your &ldquo;demo&rdquo; or &ldquo;local&rdquo; environment <em>ISLE</em> project in as little as 5 minutes.</p><h2 id=prerequisites>Prerequisites</h2><p>To successfully use <em>DG-FEDORA</em> your system will need to meet the following prerequisite requirements.</p><ul><li>Your workstation must meet all the hardware requirements of ISLE. See <em>ISLE</em>&rsquo;s <em>./docs/install/host-hardware-requirements.md</em> for details.</li><li>Your workstation environment must meet all the minimum software requirements of <em>ISLE</em>. See <em>ISLE</em>&rsquo;s <em>./docs/install/host-software-dependencies.md</em> for details.</li><li>This workflow assumes your workstation is running OSX. Other workstation types supported by <em>ISLE</em> may be acceptable, but the <em>DG-FEDORA</em> USB volume will have to be mounted differently.</li><li>You must have a working &ldquo;demo&rdquo; or &ldquo;local&rdquo; <em>ISLE</em> environment already running.</li></ul><h2 id=mounting-dg-fedora>Mounting DG-FEDORA</h2><p>In MacOSX you simply have to plug the <em>DG-FEDORA</em> USB stick into an available USB port on your Mac workstation. After a few seconds the USB stick will be automatically mounted as <em>/Volumes/DG-FEDORA</em>, and the <em>/Volumes</em> directory is automatically &ldquo;shared&rdquo; with <em>Docker</em>.</p><h3 id=make-dg-fedora-writable>Make DG-FEDORA Writable</h3><p>In MacOSX, open a terminal and use the following command to make <em>DG-FEDORA</em> writable, so that you can save newly ingested objects and updates to existing objects:</p><ul><li><code>sudo mount -u -w /Volumes/DG-FEDORA</code></li></ul><h2 id=not-using-macosx>Not Using MacOSX?</h2><p>If your workstation is not a Mac, you will need to insert the USB stick and take appropriate steps to:</p><ul><li>Mount the stick with read/write permissions as <em>/Volumes/DG-FEDORA</em>.</li><li>Share the <em>/Volumes</em> or <em>/Volumes/DG-FEDORA</em> directory in your <em>Docker</em> settings/preferences.</li></ul><h2 id=modifying-the-_isle_-environment>Modifying the <em>ISLE</em> Environment</h2><p>Navigate to your <em>ISLE</em> project directory and execute the following operations:</p><ul><li>Shut down <em>ISLE</em> if it is running. Example: <code>cd ~/pathto/ISLE; docker-compose down</code>. These commands will do no harm if <em>ISLE</em> is not currently running.</li><li>Copy two files from <em>DG-FEDORA</em> to your local project. Example: <code>cd /Volumes/DG-FEDORA; cp -f .env docker-compose.DG-FEDORA.yml ~/pathto/ISLE/.</code></li><li>Edit the new <em>ISLE</em> project <em>.env</em> file according to directions within the file. Example: <code>nano ~/pathto/ISLE/.env</code>. The objective is to select the appropriate &ldquo;demo&rdquo; or &ldquo;local&rdquo; environment as needed.</li><li>Navigate to your project directory and restart the stack. Example: <code>cd ~/pathto/ISLE; docker-compose up -d</code>.</li><li>Wait until the stack has started, open your browser and visit your site at <a href=https://isle.localdomain>https://isle.localdomain</a> (demo) or <a href=https://yourprojectnamehere.localdomain>https://yourprojectnamehere.localdomain</a> (local).</li></ul><h3 id=rebuild-_fedora_s-_resourceindex_>Rebuild <em>FEDORA</em>&rsquo;s <em>resourceIndex</em></h3><p>Rebuild your <em>FEDORA</em> <em>resourceIndex</em> using the steps documented in <a href=https://github.com/Born-Digital-US/ISLE/blob/ISLE-v.1.3.0-dev/docs/install/install-production-migrate.md#step-17-on-remote-production---re-index-fedora--solr>Step 17: On Remote Production - Re-Index Fedora & Solr</a>.</p><ul><li>Open a terminal in the <em>isle-fedora-ld</em> container, <code>docker exec -it isle-fedora-ld bash</code>, and then run <code>cd utility_scripts/; ./rebuildFedora.sh</code>.</li></ul><h3 id=rebuild-the-_solr_-index>Rebuild the <em>Solr</em> Index</h3><p>Once the previous rebuild process is complete, you should rebuild your <em>Solr</em> search index using the remaining steps documented in <a href=https://github.com/Born-Digital-US/ISLE/blob/ISLE-v.1.3.0-dev/docs/install/install-production-migrate.md#step-17-on-remote-production---re-index-fedora--solr>Step 17: On Remote Production - Re-Index Fedora & Solr</a>.</p><ul><li>Open a terminal in the <em>isle-fedora-ld</em> container, <code>docker exec -it isle-fedora-ld bash</code> (or using the terminal opened in the previous step), and then run <code>cd utility_scripts/; ./updateSolrIndex.sh</code>.</li></ul><p>This rebuilding process may take a few minutes. Proceed to the check your work after some minutes have passed.</p><h3 id=check-your-work>Check Your Work</h3><ul><li>Visit the repository home page at <a href=https://isle.localdomain/islandora/object/islandora:root>https://isle.localdomain/islandora/object/islandora:root</a> (demo) or <a href=https://yourprojectnamehere.localdomain/islandora/object/islandora:root>https://yourprojectnamehere.localdomain/islandora/object/islandora:root</a> (local). You should see new collections on the first page of your display.</li><li>Follow the install documentation for enabling the <em>Islandora Simple Search</em> block and test <em>Solr</em> by searching for a term like &ldquo;Ley&rdquo;.</li></ul><h1 id=feedback-is-welcome>Feedback is Welcome</h1><p>This is very much a work-in-progress. If you have an opinion, or would like to suggest improvements, please share!</p><p>That&rsquo;s a wrap&mldr; until next time. &#x1f604;</p></div><div class=post-footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//digital-library-applications-developer-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></main></body></html>